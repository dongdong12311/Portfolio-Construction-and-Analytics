\documentclass[a4paper,12pt,twoside]{article}
\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4}
\usepackage{ccmap}
\usepackage{CJK}
\usepackage{times}
\usepackage{latexsym}
\usepackage{graphicx}
	\graphicspath{{figures/}}	%在tex目录下新建figures文件夹存放所有图片
\usepackage[left=2.5cm,right=2.5cm,top=2.5cm,bottom=2.5cm]{geometry}
\usepackage{mathrsfs}
\usepackage{bm,array}
\usepackage{subfigure}
\usepackage{listings} %插入代码
\usepackage{xcolor} %代码高亮

\lstset{numbers=left, %设置行号位置
        numberstyle=\tiny, %设置行号大小
        keywordstyle=\color{blue}, %设置关键字颜色
        commentstyle=\color[cmyk]{1,0,1,0}, %设置注释颜色
        frame=single, %设置边框格式
        escapeinside=``, %逃逸字符(1左面的键)，用于显示中文
        breaklines, %自动折行
        extendedchars=false, %解决代码跨页时，章节标题，页眉等汉字不显示的问题
        xleftmargin=2em,xrightmargin=2em, aboveskip=1em, %设置边距
        tabsize=4, %设置tab空格数
        showspaces=false %不显示空格
       }
\usepackage{indentfirst}
	\setlength{\parindent}{2em}
\usepackage{enumerate}
\usepackage{amsmath,amsthm,amssymb,amsfonts,extarrows}
\usepackage{cite}
\usepackage[labelsep=space]{caption}
\usepackage{float}
\usepackage{fancyhdr}		%设置页眉页脚
	\renewcommand{\headrulewidth}{0.5pt}
	\renewcommand{\sectionmark}[1]{\markboth{\xiaowuhao 第\,\thesection\,章\hspace*{1em}#1}{\xiaowuhao }}
\usepackage{pdfpages}
\usepackage{titlesec}	%设置章节标题格式
	\titleformat{\section}{\xiaosanhao\hei}{第\,\thesection\,章}{1em}{}
	\titleformat{\subsection}{\sihao\hei}{\thesubsection}{1em}{}
	\titleformat{\subsubsection}{\xiaosihao\hei}{\thesubsubsection}{0em}{}
	\titlespacing{\section}{0pt}{0pt}{1em}
	\titlespacing{\subsection}{0pt}{0pt}{0em}
	\titlespacing{\subsubsection}{0pt}{0pt}{0em}
\usepackage{titletoc}		%设置目录内容格式
	\titlecontents{section}[0em]{\sihao\hei}{第\,\thecontentslabel\,章\hspace*{1em}}{}{\dotfill\contentspage}[\addvspace{-3mm}]
	\titlecontents{subsection}[1em]{\xiaosihao\hei}{\,\,\thecontentslabel\hspace*{1em}}{}{\dotfill\contentspage}[\addvspace{-3mm}]
\renewcommand{\figurename}{\wuhao\bf 图}
\renewcommand{\thefigure}{\thesection-\arabic{figure}}
\renewcommand{\contentsname}{\xiaosanhao\hei \centerline{目录}}
\renewcommand{\refname}{\xiaosanhao\hei 参考文献}
%\newcommand{\upcite}[1]{\textsuperscript{\cite{#1}}}	%若想引用参考文献时使用上标数字可使用此句
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{Proposition}[theorem]{Proposition}
\newtheorem{Remark}[theorem]{Remark}
\newtheorem{remark}[theorem]{remark}
\newtheorem{Corollary}[theorem]{Corollary}
\numberwithin{equation}{section}	%公式编号跟随章节
\allowdisplaybreaks

\renewcommand{\baselinestretch}{1.5}	%1.5倍行距
\newcommand{\erhao}{\fontsize{21pt}{\baselineskip}\selectfont}		%设置字号
\newcommand{\sanhao}{\fontsize{16pt}{\baselineskip}\selectfont}
\newcommand{\xiaosanhao}{\fontsize{15pt}{\baselineskip}\selectfont}
\newcommand{\sihao}{\fontsize{14pt}{\baselineskip}\selectfont}
\newcommand{\xiaosihao}{\fontsize{12pt}{\baselineskip}\selectfont}
\newcommand{\wuhao}{\fontsize{10.5pt}{\baselineskip}\selectfont}
\newcommand{\xiaowuhao}{\fontsize{9pt}{\baselineskip}\selectfont}

\newcommand{\song}{\CJKfamily{song}}    %设置字体
\newcommand{\hei}{\CJKfamily{hei}}
\newcommand{\Arial}{\fontfamily{phv}\selectfont}



\begin{document}
\begin{CJK*}{GBK}{song}

\renewcommand{\sectionmark}[1]{\markboth{\xiaowuhao 第\,\thesection\,章\hspace*{1em}#1}{\xiaowuhao }}
%\titleformat{\section}{\xiaosanhao\hei}{第\,\thesection\,节}{1em}{}
%\titlecontents{section}[0em]{\sihao\hei}{第\,\thecontentslabel\,节\hspace*{1em}}{}{\dotfill\contentspage}[\addvspace{-3mm}]

%----------------------------------------------------------------------------------------
%	目录
%----------------------------------------------------------------------------------------

\newpage
\begin{center}
\begin{hei}
\Large
Portfolio Construction and Analytics 读书笔记
\end{hei}
\end{center}



\thispagestyle{fancy}
\fancyhf{}
%\chead{\xiaowuhao }
\cfoot{\xiaowuhao \thepage}
\tableofcontents
\addcontentsline{toc}{section}{目录}

%完成封面到附录后，最后制作英文目录
%将已完成的所有tex代码复制粘贴至Content.tex文件，将加入目录的部分改为对应的英文即可
\newpage
\addcontentsline{toc}{section}{\Arial Contents}

%完成封面到附录后，最后制作英文目录
%将已完成的所有tex代码复制粘贴至Content.tex文件，将加入目录的部分改为对应的英文即可
\newpage
\addcontentsline{toc}{section}{\Arial Contents}


%以下每一章(包括参考文献、附录)都要另起一页，并从奇数页开始
%可以自行加入如下两行代码添加空白页
%\newpage
%\quad

%----------------------------------------------------------------------------------------
%	第一章 引言
%----------------------------------------------------------------------------------------

\newpage
\pagestyle{fancy}
\fancyhead[CE]{\rightmark}
\fancyhead[CO]{\leftmark}
\fancyfoot[CE,CO]{\xiaowuhao \thepage}
\setcounter{page}{0}
\pagenumbering{arabic}
\section{资产管理的介绍}
\section{随机变量、概率分布和重要的统计概念}
\subsection{随机变量}
随机变量：定义在样本空间 $\omega$ 上的实值函数。

\subsection{伯努利试验和概率分布函数}
设伯努利试验一次成功的概率为 $p$ 那么一重伯努利试验有如下的概率分布函数：
$$\Pr(\widetilde{X}=x)=\begin{cases}
1-p& \text{x=0}\\
p& \text{x=1}
\end{cases}
$$

\subsection{n重伯努利试验}
设伯努利试验一次成功的概率为 $p$ 那么$n$重伯努利试验成功$x$次的概率为：
$$\Pr(\widetilde{X}=x)=\frac{n!}{x!(n-x)!}p^x(1-p)^{n-x},x=0,\ldots ,n$$

\subsection{正态分布和概率分布函数}
正态分布：
$$f(x|\mu,\sigma)=\frac{1}{\sigma\sqrt{2\pi}}e^{-\frac{(x-\mu)^2}{2\sigma^2}}$$

概率分布函数(PDF):
表示随机变量在样本空间上的概率分布：$$\Pr[a\leq X\leq b]=\int _{a}^{b}f_{X}(x)\,dx$$
\subsection{累积分布函数}

累积分布函数(CDF):
$$F(x)=\Pr[X\leq b]=\int _{-\infty}^{b}f_{X}(x)\,dx$$

\subsection{描述分布}
\subsubsection{集中趋势的度量}
2.6.1.1 ~~均值：
$${\displaystyle \mu =\operatorname {E} \left[X\right]=\int _{-\infty }^{\infty }xP(x)\,dx,}$$

2.6.1.2 ~~方差：$$\begin{aligned}\operatorname {Var} (X)&=\operatorname {E} \left[(X-\operatorname {E} [X])^{2}\right]\end{aligned}$$

2.6.1.3 ~~ k阶中心矩:
$${\displaystyle \mu _{k}=\operatorname {E} \left[(X-\mu )^{k}\right]=\int _{-\infty }^{\infty }(x-\mu )^{k}P(x)\,dx,}$$

4.矩量母函数
$${\displaystyle M_t(X) =\operatorname {E} \left[e^{tX}\right]=\int _{-\infty }^{\infty }e^{tx}P(x)\,dx,}$$

\subsubsection{风险的度量}
2.6.2.1 ~~方差和标准差

在度量投资组合的风险时，首要考虑的就是投资组合的方差和标准差：

1.方差：$$\begin{aligned}\operatorname {Var} (X)&=\operatorname {E} \left[(X-\operatorname {E} [X])^{2}\right]\\&=\operatorname {E} \left[X^{2}-2X\operatorname {E} [X]+\operatorname {E} [X]^{2}\right]\\&=\operatorname {E} \left[X^{2}\right]-2\operatorname {E} [X]\operatorname {E} [X]+\operatorname {E} [X]^{2}\\&=\operatorname {E} \left[X^{2}\right]-\operatorname {E} [X]^{2}\end{aligned}$$

2.标准差： $\sigma_X=\sqrt{Var(X)}$

2.6.2.2 ~~变异系数

当需要比较两组数据离散程度大小的时候，如果两组数据的测量尺度相差太大，或者数据量纲的不同，直接使用标准差来进行比较不合适，此时就应当消除测量尺度和量纲的影响，而变异系数可以做到这一点，它是原始数据标准差与原始数据平均数的比。CV没有量纲，这样就可以进行客观比较了。事实上，可以认为变异系数和极差、标准差和方差一样，都是反映数据离散程度的绝对值。其数据大小不仅受变量值离散程度的影响，而且还受变量值平均水平大小的影响。

变异系数的定义：
$${\displaystyle c_{\rm {v}}={\frac {\sigma }{\mu }}}$$

例如：投资组合A的变异系数为0.8,投资组合B的变异系数为0.5，那么我们可以认为投资组合A的风险比较大。

2.6.2.3 ~~范围

随机变量的范围：即随机变量的取值范围。例如正态分布的取值范围是负无穷到正无穷。

2.6.2.4 ~~百分位数

随机变量X或它的概率分布的分位数$Z_a$，是指满足条件$\Pr(X\leq Z_a)=\alpha$ 的实数

2.6.2.5 ~~风险价值

风险价值 VaR(Value at Risk)：在市场正常波动下，某一金融资产或证券组合的最大可能损失。更为确切的是指，在一定概率水平（置信度）下，某一金融资产或证券组合价值在未来特定时期内的最大可能损失。

给定置信度 $\alpha$:
$${\displaystyle \operatorname {VaR} _{\alpha }(X)=\inf {\big \{}x\in \mathbb {R} :F_{X}(x)>\alpha {\big \}}=F_{Y}^{-1}(1-\alpha ).}$$

2.6.2.6 ~~条件风险价值

在投资组合超过某个给定 VaR值的条件下，该投资组合的平均损失值。
$$ CVaR_{\alpha }(X)=E[-X\mid X\leq -VaR_{\alpha }(X)]$$

\subsubsection{偏度}

偏度（skewness），是统计数据分布偏斜方向和程度的度量，是统计数据分布非对称程度的数字特征。
我们可以从图片中（来自wiki百科）直观地看出正偏度和负偏度：

1.负偏度。密度函数左边的尾巴更加厚实，随机变量主要的取值分布在右边，通常我们也把他称为"右倾斜"。

2.正偏度。密度函数右边的尾巴更加厚实，随机变量主要的取值分布在左边，通常我们也把他称为"左倾斜"。
\begin{figure}[h]
\centering  %让图片居中
\includegraphics[width=0.5\textwidth]{1.png}
\end{figure}

计算公式：
$${\displaystyle \gamma _{1}=\operatorname {E} \left[\left({\frac {X-\mu }{\sigma }}\right)^{3}\right]={\frac {\mu _{3}}{\sigma ^{3}}}={\frac {\operatorname {E} \left[(X-\mu )^{3}\right]}{\ \ \ (\operatorname {E} \left[(X-\mu )^{2}\right])^{3/2}}}={\frac {\kappa _{3}}{\kappa _{2}^{3/2}}}}$$

\subsubsection{峰度}

峰度是描述总体中所有取值分布形态陡缓程度的统计量。这个统计量需要与正态分布相比较，峰度为3表示该总体数据分布与正态分布的陡缓程度相同；峰度大于3表示该总体数据分布与正态分布相比较为陡峭，为尖顶峰；峰度小于3表示该总体数据分布与正态分布相比较为平坦，为平顶峰。峰度的绝对值数值越大表示其分布形态的陡缓程度与正态分布的差异程度越大。

计算公式：
$${\displaystyle \operatorname {Kurt} [X]=\operatorname {E} \left[\left({\frac {X-\mu }{\sigma }}\right)^{4}\right] = {\frac {\mu _{4}}{\sigma ^{4}}} ={\frac {\operatorname {E} [(X-\mu )^{4}]}{(\operatorname {E} [(X-\mu )^{2}])^{2}}}}$$

\subsection{协方差和相关系数}

协方差:用于衡量两个变量的总体误差。而方差是协方差的一种特殊情况，即当两个变量是相同的情况。期望值分别为E[X]与E[Y]的两个实随机变量X与Y之间的协方差Cov(X,Y)定义为：
$$\operatorname {cov} (X,Y)=\operatorname {E} {{\big [}(X-\operatorname {E} [X])(Y-\operatorname {E} [Y]){\big ]}}$$

相关系数：研究变量之间线性相关程度的量。随机变量 X和 Y 的相关系数定义为：
$$\rho _{X,Y}=\mathrm {corr} (X,Y)={\mathrm {cov} (X,Y) \over \sigma _{X}\sigma _{Y}}={E[(X-\mu _{X})(Y-\mu _{Y})] \over \sigma _{X}\sigma _{Y}}$$

\subsection{随机变量和的性质}

1.随机变量和的期望。
$$\operatorname{E}[aX+bY]=a\cdot\operatorname{E}[X]+b\cdot\operatorname{E}[Y]$$

2.随机变量和的方差。
$$Var[aX+bY]=a^2\cdot Var[X]+b^2\cdot Var[Y]+2\cdot a \cdot b \cdot Cov(X,Y)$$

2.随机变量和的分布。
对于独立的随机变量 X 和 Y, 随机变量 Z = X + Y 的密度函数就是 X的密度函数和Y的密度函数的卷积。
$$
{\displaystyle f_{Z}(z)=\int _{-\infty }^{\infty }f_{Y}(z-x)f_{X}(x)\,dx} {\displaystyle f_{Z}(z)=\int _{-\infty }^{\infty }f_{Y}(z-x)f_{X}(x)\,dx}$$

\subsection{联合概率分布和条件概率}

对于离散型随机变量X,Y，当 X=x时，Y 的条件分布为：
$$\displaystyle P_{Y}(y\mid X=x)=P(Y=y\mid X=x)={\frac {P(X=x\ \cap Y=y)}{P(X=x)}}$$

同样对于连续型随机变量，当 X=x时，Y 的条件分布为：
$$f_{Y}(y\mid X=x)={\frac {f_{X,Y}(x,y)}{f_{X}(x)}}$$

一般的我们有如下结论：

1.重期望公式：$ E(E(X\mid {\mathcal  {H}}))=E(X)$

2.条件方差公式：$ \operatorname {Var}(X)=\operatorname {E}(\operatorname {Var}(X\mid {\mathcal  {H}}))+\operatorname {Var}(\operatorname {E}(X\mid {\mathcal  {H}}))$

3.条件协方差公式：$\displaystyle \operatorname {cov} (X,Y)=\operatorname {E} (\operatorname {cov} (X,Y\mid Z))+\operatorname {cov} (\operatorname {E} (X\mid Z),\operatorname {E} (Y\mid Z))$

\begin{flushleft}
\hei{边缘分布和密度函数}
\end{flushleft}

对于离散型随机变量：
$$\displaystyle \Pr(X=x)=\sum _{y}\Pr(X=x,Y=y)=\sum _{y}\Pr(X=x\mid Y=y)\Pr(Y=y)$$

对于连续型随机变量：
$$\displaystyle p_{X}(x)=\int _{y}p_{X,Y}(x,y)\,\mathrm {d} y=\int _{y}p_{X\mid Y}(x\mid y)\,p_{Y}(y)\,\mathrm {d} y$$

\subsection{Copulas}


copula函数描述的是变量间的相关性，实际上是一类将联合分布函数与它们各自的边缘分布函数连接在一起的函数，因此也有人将它称为连接函数。相关理论的提出可以追溯到1959年，Sklar 通过定理形式将多元分布与Copula函数联系起来。

 Copula函数的定义：$ C:[0,1]^{d}\rightarrow [0,1] $ 称为是一个d维 copula函数如果：
\begin{align*}
\bullet &C(u_{1},\dots ,u_{i-1},0,u_{i+1},\dots ,u_{d}) =0,\text{如果某个分量为零，函数为零，}\\
\bullet&C(1,\dots ,1,u,1,\dots ,1)=u,\text{如果函数的d-1个分量为1，那么函数是把u映成u，}\\
\bullet &C\text{对于它的每一个分量是非减的。}
\end{align*}

\begin{flushleft}
\hei{Sklar定理}
\end{flushleft}

Sklar 定理（二元形式）： 若$H(x,y)$是一个具有连续边缘分布的$F(x)$与$G(y)$的二元联合分布函数，那么存在
唯一的copula函数$C$，使得 $H(x,y) = C( F(x), G(y) )$。 反之，如果$C$是一个$copula$函数，而$F$ 和$G $是两个任
意的概率分布函数，那么由上式定义的H函数一定是一个联合分布函数，且对应的边缘分布刚好就是$F$和$G$。

\begin{flushleft}
\hei{Copulas函数族}
\end{flushleft}

1.高斯Copula函数

高斯Copula函数是定义在单位立方体$ [0,1]^{d}.$上面的函数。它是通过定义在$ {\displaystyle \mathbb {R} ^{d}}$上的多元正态函数构造的。

给定一个相关系数矩阵$ {\displaystyle R\in [-1,1]^{d\times d}}$, 参数为 $R$的高斯Copula函数可以写成：
$$
C_{R}^{\text{Gauss}}(u)=\Phi _{R}\left(\Phi ^{-1}(u_{1}),\dots ,\Phi ^{-1}(u_{d})\right),$$
其中$ \Phi ^{-1} $标准正态分布函数的逆而$ \Phi _{R}$ 是均值为零、协方差为$R$的多元正态分布。

2.阿基米德Copula函数

函数 C 被称为阿基米德copula 如果它满足如下条件：
$$
{\displaystyle C(u_{1},\dots ,u_{d};\theta )=\psi ^{[-1]}\left(\psi (u_{1};\theta )+\cdots +\psi (u_{d};\theta );\theta \right)}$$
其中$\psi \!:[0,1]\times \Theta \rightarrow [0,\infty ) $是连续、 严格递减的凸函数，并且满足：$ \psi (1;\theta )=0$。$\theta $ 从属于某个参数空间$  \Theta $.

\begin{center}
常用的阿基米德copula函数：
\end{center}

\begin{center}
\begin{tabular}{|c|c|c|}
  \hline
  % after \\: \hline or \cline{col1-col2} \cline{col3-col4} ...
  \text{名称} & $ \;C_{\theta }(u,v) $& 参数$\theta $ \\
  \hline
  Ali-Mikhail-Haq & ${\frac {uv}{1-\theta (1-u)(1-v)}}$ & $ \theta \in [-1,1)$ \\
   \hline
  Clayton & $\left[\max \left\{u^{-\theta }+v^{-\theta }-1;0\right\}\right]^{-1/\theta }$ & $ \theta \in [-1,\infty )\backslash \{0\}$ \\ \hline
  Frank & $-{\frac {1}{\theta }}\log \!\left[1+{\frac {(\exp(-\theta u)-1)(\exp(-\theta v)-1)}{\exp(-\theta )-1}}\right]  $ & $   \theta \in \mathbb {R} \backslash \{0\}  $  \\ \hline
  Gumbel &$ {\textstyle \exp \!\left[-\left((-\log(u))^{\theta }+(-\log(v))^{\theta }\right)^{1/\theta }\right]}$  &$ \theta \in [1,\infty )$ \\ \hline
 Independence & ${\textstyle uv}$  &   \\ \hline
  Joe & $ {\textstyle {1-\left[(1-u)^{\theta }+(1-v)^{\theta }-(1-u)^{\theta }(1-v)^{\theta }\right]^{1/\theta }}}$  & $\theta \in [1,\infty )$ \\
  \hline
\end{tabular}
\end{center}

\subsection{概率分布和取样}

在通常情况下，我们无法知道总体的分布情况。所以我们通常通过样本来估计总体。例如，我们独立地观测到 $n$个样本数据： $X_1,\ldots,X_n$,通常采用如下的公式估计总体的均值、方差等参数：

样本均值： $$\bar{X} = \frac{1}{n}\sum\limits_{i=1}^n X_i$$

样本方差： $$s_2=\frac{1}{n-1}\sum\limits_{i=1}^{n}(X_n-\bar{X})^2$$

样本标准差： $$s=\sqrt{\frac{1}{n-1}\sum\limits_{i=1}^{n}(X_n-\bar{X})^2}$$

样本协方差：$$sCov(\bar{X},\bar{Y})=\frac{1}{n-1}\sum\limits_{i=1}^{n}(X_n-\bar{X})(Y_n-\bar{Y})$$

样本相关系数：$$r(\bar{X},\bar{Y})=\frac{sCoV(\bar{X},\bar{Y})}{s_Xs_Y}$$

\subsubsection{中心极限定理}

独立同分布的中心极限定理:

设随机变量$X_1，X_2，\ldots X_n$独立同分布，并且具有有限的数学期望和方差：$E(X_i)=\mu$，$ Var[X_i] = \sigma^2 < \infty $，

则对任意$z$:
$$
 {\displaystyle \lim _{n\to \infty }\Pr \left[{\sqrt {n}}(S_{n}-\mu )\leq z\right]=\Phi \left({\frac {z}{\sigma }}\right),}$$
 其中$$ S_{n}:={\frac {X_{1}+\cdots +X_{n}}{n}}$$为样本的均值。

\subsubsection{置信区间}

置信区间是一种常用的区间估计方法，所谓置信区间就是分别以统计量的置信上限和置信下限为上下界构成的区间 。对于一组给定的样本数据，其平均值为$\mu$，标准偏差为$\sigma$，则其整体数据的平均值的$100(1-\alpha)$ $\%$ 置信区间为$(\mu-Z_{\frac{\alpha}{2}}\sigma , \mu+Z_{\frac{\alpha}{2}}\sigma )$ ，其中α为非置信水平在正态分布内的覆盖面积 $Z_{\frac{\alpha}{2}}$ 即为对应的标准分数。

\subsubsection{Bootstrapping}

Bootstrapping算法，指的就是利用有限的样本资料经由多次重复抽样，重新建立起足以代表母体样本分布的新样本。我们会在后续的章节中结合蒙特卡洛模拟给出详细的介绍。

\subsubsection{假设检验}

假设检验(Hypothesis Testing)是数理统计学中根据一定假设条件由样本推断总体的一种方法。具体作法是：根据问题的需要对所研究的总体作某种假设，记作$H_0$；选取合适的统计量，这个统计量的选取要使得在假设$H_0$成立时，其分布为已知；由实测的样本，计算出统计量的值，并根据预先给定的显著性水平进行检验，作出拒绝或接受假设$H_0$的判断。常用的假设检验方法有$u$检验法、$t$检验法、$\chi^2$检验法(卡方检验)、$F$ 检验法，秩和检验等。我们会在后续的章节中给出详细的介绍。
\section{常见的分布函数介绍}
\subsection{分布函数的样例}
\subsubsection{记号说明}

Gama 函数的定义如下：
$$
{\displaystyle \Gamma (z)=\int _{0}^{\infty }x^{z-1}e^{-x}\,dx}$$

Beta函数的定义如下：
$${\displaystyle \mathrm {B} (x,y)=\int _{0}^{1}t^{x-1}(1-t)^{y-1}\,dt}$$

\subsubsection{离散型和连续型均匀分布}

离散型均匀分布：
$$\Pr(X=x)=\frac{1}{N}$$

连续型均匀分布：
$$f(x)={\begin{cases}{\frac {1}{b-a}}&\mathrm {for} \ a\leq x\leq b,\\[8pt]0&\mathrm {for} \ x<a\ \mathrm {or} \ x>b\end{cases}}
$$

\begin{figure}[h]
\begin{minipage}[t]{0.5\linewidth}
\centering
\includegraphics[width=2.2in]{3121.png}
\caption{离散型均匀分布}
\label{fig:side:a}
\end{minipage}%
\begin{minipage}[t]{0.5\linewidth}
\centering
\includegraphics[width=2.2in]{3122.png}
\caption{连续型均匀分布}
\label{fig:side:b}
\end{minipage}
\end{figure}

\subsubsection{t分布}

密度函数:
$$f(t) = \frac{\Gamma(\frac{\nu+1}{2})} {\sqrt{\nu\pi}\,\Gamma(\frac{\nu}{2})} \left(1+\frac{t^2}{\nu} \right)^{\!-\frac{\nu+1}{2}},\!$$


自由度分别为1，2，3的t分布的密度函数。其中蓝色的线条表示正态分布的密度函数。绿色的线条表示上一幅图中t分布的密度函数。


\begin{figure}[h]
\begin{minipage}[t]{0.32\linewidth}
\centering
\includegraphics[width=2.2in]{3131.png}
\caption{自由度为1}
\end{minipage}%
\begin{minipage}[t]{0.32\linewidth}
\centering
\includegraphics[width=2.2in]{3132.png}
\caption{自由度为2}
\end{minipage}
\begin{minipage}[t]{0.32\linewidth}
\centering
\includegraphics[width=2.2in]{3133.png}
\caption{自由度为3}
\end{minipage}
\end{figure}

\subsubsection{对数正态分布}

对数正态分布（logarithmic normal distribution）是指一个随机变量的对数服从正态分布，则该随机变量服从对数正态分布。对数正态分布从短期来看，与正态分布非常接近。但长期来看，对数正态分布向上分布的数值更多一些。

密度函数：
$${\displaystyle {\begin{aligned}f_{X}(x)&={\frac {\rm {d}}{{\rm {d}}x}}\Pr(X\leq x)={\frac {\rm {d}}{{\rm {d}}x}}\Pr(\ln X\leq \ln x)\\[6pt]&={\frac {\rm {d}}{{\rm {d}}x}}\Phi \left({\frac {\ln x-\mu }{\sigma }}\right)\\[6pt]&=\varphi \left({\frac {\ln x-\mu }{\sigma }}\right){\frac {\rm {d}}{{\rm {d}}x}}\left({\frac {\ln x-\mu }{\sigma }}\right)\\[6pt]&=\varphi \left({\frac {\ln x-\mu }{\sigma }}\right){\frac {1}{\sigma x}}\\[6pt]&={\frac {1}{x}}\cdot {\frac {1}{\sigma {\sqrt {2\pi \,}}}}\exp \left(-{\frac {(\ln x-\mu )^{2}}{2\sigma ^{2}}}\right).\end{aligned}}}$$

\begin{figure}[h]
\centering
\includegraphics[width=2.2in]{314.png}
\caption{两种不同偏度的对数正态分布}
\end{figure}

\subsubsection{泊松分布}

密度函数：
$${\displaystyle P(X=k)=e^{-\lambda }{\frac {\lambda ^{k}}{k!}}}$$

\begin{figure}[h]
\centering
\includegraphics[width=2.2in]{315.png}
\caption{不同$\lambda$值的泊松分布}
\end{figure}
值得一提的是，随着 $\lambda$的递增，泊松分布会不断逼近均值为$\lambda$，方差为$\sqrt{\lambda}$ 的正态分布，这一结论在金融模型中有重要的应用。

\subsubsection{指数分布}

在概率理论和统计学中，指数分布（也称为负指数分布）是描述泊松过程中的事件之间的时间的概率分布，即事件以恒定平均速率连续且独立地发生的过程。 这是伽马分布的一个特殊情况。

密度函数：
$$ f(x;\lambda) = \begin{cases}
\lambda e^{-\lambda x} & x \ge 0, \\
0 & x < 0.
\end{cases}$$

\newpage
\begin{figure}[h]
\centering
\includegraphics[width=2.2in]{316.png}
\caption{不同参数的指数分布}
\end{figure}

\subsubsection{卡方分布}

若n个相互独立的随机变量$\xi_1,\xi_2,\ldots,\xi_n$，均服从标准正态分布（也称独立同分布于标准正态分布），则这n个服从标准正态分布的随机变量的平方和构成一新的随机变量，其分布规律称为卡方分布（chi-square distribution）。

密度函数：
$${\displaystyle f(x;\,k)={\begin{cases}{\dfrac {x^{{\frac {k}{2}}-1}e^{-{\frac {x}{2}}}}{2^{\frac {k}{2}}\Gamma \left({\frac {k}{2}}\right)}},&x>0;\\0,&{\text{otherwise}}.\end{cases}}}$$

\begin{figure}[h]
\centering
\includegraphics[width=2.2in]{317.png}
\caption{不同参数的卡方分布}
\end{figure}

\subsubsection{伽玛分布}

伽玛分布（Gamma Distribution）是统计学的一种连续概率函数，是概率统计中一种非常重要的分布。"指数分布"和"$\chi^2$分布"都是伽马分布的特例。

Gamma分布中的参数α称为形状参数（shape parameter），β称为尺度参数（scale parameter）。

密度函数：$$
{\displaystyle f(x;\alpha ,\beta )={\frac {\beta ^{\alpha }x^{\alpha -1}e^{-\beta x}}{\Gamma (\alpha )}}\quad {\text{ for }}x>0{\text{ and }}\alpha ,\beta >0,}$$

\subsubsection{贝塔分布}

在概率论中，贝塔分布，也称Β分布，是指一组定义在(0,1) 区间的连续概率分布。

密度函数：$${\displaystyle {\begin{aligned}f(x;\alpha ,\beta )&=\mathrm {constant} \cdot x^{\alpha -1}(1-x)^{\beta -1}\\[3pt]&={\frac {x^{\alpha -1}(1-x)^{\beta -1}}{\displaystyle \int _{0}^{1}u^{\alpha -1}(1-u)^{\beta -1}\,du}}\\[6pt]&={\frac {\Gamma (\alpha +\beta )}{\Gamma (\alpha )\Gamma (\beta )}}\,x^{\alpha -1}(1-x)^{\beta -1}\\[6pt]&={\frac {1}{\mathrm {B} (\alpha ,\beta )}}x^{\alpha -1}(1-x)^{\beta -1}\end{aligned}}}$$

\begin{figure}[h]
\centering
\includegraphics[width=2.2in]{319.png}
\caption{不同参数的贝塔分布}
\end{figure}

\subsection{金融回报率的分布模型}
\subsubsection{椭圆分布族}

椭圆分布的密度函数具有如下形式：
$$f(x)=\frac{c}{\sqrt{|\Sigma|}}\cdot g((x-\mu )'\Sigma ^{{-1}}(x-\mu ))$$

例如，我们所熟知的多元正态分布就属于椭圆分布族：
$${\displaystyle {\begin{aligned}f_{\mathbf {X} }(x_{1},\ldots ,x_{k})&={\frac {\exp \left(-{\frac {1}{2}}({\mathbf {x} }-{\boldsymbol {\mu }})^{\mathrm {T} }{\boldsymbol {\Sigma }}^{-1}({\mathbf {x} }-{\boldsymbol {\mu }})\right)}{\sqrt {(2\pi )^{k}|{\boldsymbol {\Sigma }}|}}}\end{aligned}}}$$

\subsubsection{稳定Paretian分布族}
稳定Paretian分布族主要包括如下三个分布：正态分布，柯西分布，列维分布。例如我们所熟知的柯西分布，其密度函数为:
$$f(x)={\frac  {1}{\pi \gamma \left[1+\left({\frac  {x-\mu}{\gamma }}\right)^{2}\right]}}={1 \over \pi \gamma }\left[{\gamma ^{2} \over (x-\mu)^{2}+\gamma ^{2}}\right],$$

以及列维分布，其密度函数为：
$$f(x;\mu,\gamma )=\sqrt{\frac{\gamma }{2\pi}}~~\frac{e^{ -\frac{\gamma }{2(x-\mu)}}} {(x-\mu)^{3/2}}$$

我们把$\mu$称为位置参数，而把 $\gamma $称为尺度参数。

\subsubsection{广义$\lambda$分布族}

Tukey $\lambda $分布：
$$
F^{-1}(p)=Q\left(p;\lambda\right) =
\begin{cases}
\frac{ 1 }{ \lambda } \left[p^\lambda - (1 - p)^\lambda\right], & \mbox{if } \lambda \ne 0 \\
\log(\frac{p}{1-p}), & \mbox{if } \lambda = 0,
\end{cases}$$

Tukey$\lambda$分布可以近似一些常见的分布：\\
λ = -1:	~~ 接近柯西分布$ C(0,π)$\\
λ = 0:~~	logistic分布\\
λ = 0.14:~~	接近正态分布 $N(0, 2.142)$\\
λ = 1:~~	均匀分布 $ U(-1, 1)$

利用Tukey分布我们可以定义广义 $\lambda $分布(GLD)：
$$
F^{-1}(p)=Q\left(p;\lambda\right) =
\lambda_1+\frac{ 1 }{ \lambda_2 } \left[p^\lambda_3 - (1 - p)^\lambda_4\right]$$
上述分布的VaR和CVaR都是容易计算的。

\subsection{金融回报率的尾部风险模型}
\subsubsection{广义极值分布}
采用标准化的方法：
$${\displaystyle s=(x-\mu )/\sigma }$$可以得到：
标准广义极值分布的密度函数：
$${\displaystyle f(s;\xi )={\begin{cases}(1+\xi s)^{(-1/\xi )-1}\exp(-(1+\xi s)^{-1/\xi })&\xi \neq 0\\\exp(-s)\exp(-\exp(-s))&\xi =0\end{cases}}}$$


\begin{figure}[h]
\centering
\includegraphics[width=3in]{331.png}
\caption{不同参数下的极值分布}
\end{figure}

\subsubsection{广义帕累托分布}
同样的采用标准化的方法：
$${\displaystyle s=(x-\mu )/\sigma }$$可以得到：
标准广义帕累托分布的密度函数：
$$f_{{(\xi ,\mu ,\sigma )}}(x)={\frac  {1}{\sigma }}\left(1+{\frac  {\xi (x-\mu )}{\sigma }}\right)^{{\left(-{\frac  {1}{\xi }}-1\right)}},$$

\begin{figure}[h]
\centering
\includegraphics[width=3in]{332.png}
\caption{不同参数下的帕累托分布}
\end{figure}

\subsubsection{极值模型}
为了拟合GDP模型，我们通常采用极大似然法估计参数（MLE）一旦GDP的参数估计完成以后，我们就可以计算模型的VaR和CVaR了：
$$(100-\epsilon)\%VaR = u+\frac{\theta}{\xi}((\frac{n}{N_u}(1-\frac{\epsilon}{100}))^{-\xi}-1)$$

其中 $u$是门限，$n$是观测数量， $N_u$是观测值大于门限值的数量。

\section{统计学模型}
\subsection{经典收益模型}

最为经典的线性回归模型可以表示为：
$${\displaystyle r_{i}=\alpha _{i}+f _{1}\beta_{i1}+\cdots +f _{p}\beta_{ip}+\varepsilon _{i} \qquad i=1,\ldots ,n,}$$

$r_i$:第i份资产收益率

$f_k$：影响因子

$\beta$:回归系数（灵敏度）

$\alpha$:常数

$\varepsilon _{i} $随机扰动

我们之所以给出上述的模型，是假设收益率可以通过一些可观测的因子线性表出。上述的模型的衍生是多种多样的。例如：上述的模型是静态的，我们可以在不同的时间下观测数据，从而建立模型：
$${\displaystyle r_{i,t+1}=\alpha _{i}+f _{1t}\beta_{i1}+\cdots +f _{pt}\beta_{ip}+\varepsilon _{it} \qquad i=1,\ldots ,n,}$$

\subsection{回归分析}
\subsubsection{一个简单的例子}

假设我们想研究保洁公司股票的收益率和标普500指数的关系，我们可以建立如下的回归模型：
$$r_{P\&G}=\alpha+\beta r_{S\&P500}+\varepsilon$$
其中:

$r_{P\&G}$：保洁公司股票的收益率。

$r_{P\&G500}$:标普500指数收益率。

我们选取了过去78个月份的数据进行回归分析，得到如下的回归方程：
$$r_{P\&G}=0.0021+0.4617r_{S\&P500}$$

经过P值检验，$\beta$系数显著不为0，经过F检验回归方程显著。为了确保回归模型的有效性，我们还需要对残差进行如下的检验：

1.对$\varepsilon$进行正态性检验

2.对$\varepsilon$进行方差齐性检验

3.对$\varepsilon$进行自相关检验

\subsubsection{回归分析在投资中的应用}

回归分析在投资中的应用主要在于以下四个方面：

1.建立投资策略

2.选择投资策略

3.选择标的资产

4.评估策略表现

\subsection{因子分析}

一个因子分析模型和回归分析模型十分相似，例如资产回报率模型可以写成：
$$r=\alpha + B\cdot f +\varepsilon
$$
其中 $\alpha$是 N维列向量，表示资产的平均回报率。f是K维因子向量，B是N$\times$K维因子载荷矩阵。

因子分析存在的问题：尽管我们可以计算出具体的因子，但是有时候我们难以对因子给出合理的解释。

\subsection{主成分分析}
主成分分析（Principal Component Analysis，PCA）， 是一种统计方法。通过正交变换将一组可能存在相关性的变量转换为一组线性不相关的变量，转换后的这组变量叫主成分。

设是数据的协方差矩阵，PCA的主要步骤:

求解矩阵 $\mathbf{W^T}$ 满足如下的条件。
$$Max ~~\mathbf{W^T}\mathbf{\Sigma}\mathbf{W} $$$$
~~ s.t. \mathbf{W^T}\mathbf{W}=1 $$

作为一个例子，我们考虑10支股票（AXP, T, BA, CAT, CVX, CSCO,
KO, DD, XOM, GE）构成的投资组合在过去78个月内的收益率。我们计算得到各个主成分如下：

\begin{figure}[htbp]
\centering
\includegraphics[width=6in]{44.png}
\caption{主成分}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics[width=6in]{442.png}
\caption{各个主成分占比}
\end{figure}

从中我们可以看到，前三个主成分解释了总体 74 $\%$的方差。通常我们选取占比较高的前几个成分作为我们的主成分，一旦我们确定了主成分我们就可以采用如下的公式计算得分了：

$$x_k=\sum_{i=1}^{N}\beta_{ik}r_i$$

\subsection{自回归条件方差模型}
传统的回归模型假设残差的方差是相同的，然而这样的假设存在如下的问题：

1.金融资产的回报率的振幅随时间变化，并且在某一时期，巨大的资产振幅往往预示着未来一段时间的振幅也会比较大。这也是我们所说的波动集群效应。

2.高频金融数据往往具有厚尾性，这与传统的数据服从正态分布的假设相矛盾。

基于上述的问题，我们引入了ARCH和GARCH模型。

ARCH(q):

以 ${\displaystyle \varepsilon _{t}}$  表示收益或者收益残差，假设 ${\displaystyle \varepsilon _{t}=\sigma _{t}z_{t}} $ ，此处 $ z_t\sim i.i.d\ N(0,1)$ （即独立同分布，均符合期望为0，方差为1 的正态分布）。在此条件下 $\sigma^2 _{t}$可以写成：
$$\sigma _{t}^{2}=\alpha _{0}+\alpha _{1}\epsilon _{{t-1}}^{2}+\cdots +\alpha _{q}\epsilon _{{t-q}}^{2}=\alpha _{0}+\sum _{{i=1}}^{q}\alpha _{{i}}\epsilon _{{t-i}}^{2},$$
其中$\alpha _{i}\geq 0,~i>0.$

GARCH(p,q):

${\displaystyle y_{t}=x'_{t}b+\epsilon _{t}}$

${\displaystyle \epsilon _{t}|\psi _{t-1}\sim {\mathcal {N}}(0,\sigma _{t}^{2})}$

${\displaystyle \sigma _{t}^{2}=\omega +\alpha _{1}\epsilon _{t-1}^{2}+\cdots +\alpha _{q}\epsilon _{t-q}^{2}+\beta _{1}\sigma _{t-1}^{2}+\cdots +\beta _{p}\sigma _{t-p}^{2}=\omega +\sum _{i=1}^{q}\alpha _{i}\epsilon _{t-i}^{2}+\sum _{i=1}^{p}\beta _{i}\sigma _{t-i}^{2}}$

对于 ARCH和GARCH模型，我们容易计算他们的VaR和CVaR：
$$VaR_{1-\varepsilon}=V_t(-u_r+q_{1-\varepsilon}\sigma_r)$$
其中 $q_{1-\varepsilon}$为标准正态分布$100(1-\varepsilon)$分位数。
同时：
$$CVaR_(1-\varepsilon)=V_t(-u_r+\frac{\phi(q_{1-\varepsilon})}{\varepsilon}\sigma_r)$$
\section{模型模拟}
\subsection{蒙特卡罗模拟}
假设你现在有1000美元。你计划用这笔资金投资标普500指数。$C_0,C_1$分别表示期初和期末（一年以后）
的资金。$r_{0,1}$表示期间资金的回报率。则有：
$$C_1=(1+r_{0,1})C_0$$
在$[t,t+1]$区间内资金的回报率可以表示成：
$$r_t=\frac{P_{t+1}-P_t+D_t}{P_t}$$

$P_t$:标普500指数在$t$时刻的价格

$D_t$:在区间$[t,t+1]$内的标普500指数的股息
\subsubsection{选择分布函数}
为了采用蒙特卡罗模拟我们的模型，我们首先要确定模拟数据的分布函数。这里有两种方法确定数据的分布函数。第一种是采用历史数据，第二种是随机产生一种给定分布的数据序列。例如，我们可以生成一组均值为$\mu$，方差为$\sigma$的正态分布的数据。


\subsubsection{理解蒙特卡罗模拟的输出}

作为蒙特卡罗模拟的一个例子，我们模拟了标普指数一年以后的收益情况。我们生成了100个服从正态分布的随机数（均值为8.79$\%$,方差为 $14.65\%$）图表中的直方图展示了未来一年的收益率分布：

\begin{figure}[h]
\centering
\includegraphics[width=5in]{512.png}
\caption{未来一年标普500收益率分布}
\end{figure}

根据统计学的知识我们可以知道，我们有$95\%$的置信度认为一年后的收益率分布的区间：
$${\displaystyle \left({\bar {x}}-z^{*}{\sigma  \over {\sqrt {n}}},{\bar {x}}+z^{*}{\sigma  \over {\sqrt {n}}}\right)}=(1058.9,1116.9)
$$

\subsection{为什么采用蒙特卡罗模拟}

上面的例子给出了蒙特卡罗模拟的基本方法，我们采用上述方法，给出了一年以后收益率的分布情况。值得注意的是，如果标普500收益率不满足正态分布，那么我们的模拟就不准确了。下面的例子是一个更加复杂的模拟。

\subsubsection{多个输入变量和混合分布}

假设你为未来养老而计划做一笔投资，投资的本金为1000美元，投资的周期为30年。假设标普500指数服从均值为$\mu$，方差为$\sigma$的正态分布。记期初的资金为 $C_0$,期末的资金为 $C_{30}$。容易知道，期末的收益可以写成：
$$r_{0,t}=(1+r_{0,1})(1+r_{1,2})\ldots(1+r_{t-1,t})-1$$
期末的收益取决于这30个正态分布。

\subsubsection{合并相关}
如果我们投资的是两类标的：国债和股票。这二者的收益率存在着负相关。那么我们又该如何模拟呢？不妨假设股票和国债收益率的相关系数为-0.2。国债收益率服从均值为$4\%$，方差为$7\%$的正态分布。我们采用蒙特卡罗进行了500次模拟，下图展示了30年后收益率的分布情况：
\begin{figure}[h]
\centering
\includegraphics[width=5in]{522.png}
\end{figure}

\subsubsection{模型评估}
如何评估模型的好坏呢？我们考虑下面两种不同的策略：

A：$50\%$资金投资股票，$50\%$资金投资债券

B：$30\%$资金投资股票，$70\%$资金投资债券

我们对投资组合A和投资组合B都进行了400次模拟。从模拟的结果我们可以看到，30年后，投资组合A
的平均收益大于投资组合B。但是投资组合A的变异系数也大于投资组合B。这说明投资组合A的风险比B大。课本上的图标罗列了二者的均值、方差、峰度、偏度。从中我们可以直观地看到两个投资组合的差异。
\begin{figure}[h]
\centering
\includegraphics[width=5in]{523.png}
\end{figure}
\subsubsection{模拟多少次？}
模拟的数据至少要大于等于30才具有统计学意义。在上述的例子中我们模拟了400个样本用于分析。一般来说提高样本的数量有助于我们提高模拟的精度。
\subsubsection{随机数的生成}
Excel、R、MATLAB 都可以很方便地生成随机数，可参考各软件的文档、也可百度。
\section{模型优化}
本章我们主要讨论的是优化问题――在一系列限制条件下如何使得我们的模型是最优的。
\subsection{优化公式}
一个优化问题的数学表达式主要由以下三个部分组成：

1.一系列的决策变量（一般由一个 $N \times 1$维的向量组成）

2.一个目标函数

3.一系列的限制条件$(g_i(x),h_j(x))$满足： $g_i(x)\leq 0,h_j(x)= 0$

一般来说我们的目标函数总是可以写成：

\begin{center}
Maximize： 资产预期回报率
\end{center}

\subsubsection{最大化和最小化}
通常来说，最优化问题可以写成如下的表达式：
$${\begin{aligned}{\text{minimize }}&f(x)\\{\text{subject to }}&g_{i}(x)\leq 0 ~~i\in \{1,\dotsc ,I\}\\&h_{j}(x)=0 ~~j\in \{1,\dotsc ,J\}.\end{aligned}}$$

同时最大化问题和最小化问题也是可以相互转化的：

$$\max_x f(x) = -\min_x -f(x)$$
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{611.png}
\caption{最大化f(x)相当于最小化-f(x)}
\end{figure}

\subsubsection{局部最优和全局最优}
在求解最优解的时候，部分算法（例如梯度下降法）容易陷入局部最优解而无法得到全局最优解。
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{612.png}
\end{figure}
\subsubsection{多目标优化}
多目标规划是数学规划的一个分支。研究多于一个的目标函数在给定区域上的最优化。又称多目标最优化。通常记为 MOP(multi-objective programming)。
求解多目标线性规划的基本思想是将多目标转化为单目标，常见的方法有理想点法、线性加权法、最大最小法、目标规划法、模糊数学解法等。

\subsection{重要的优化问题}

\subsubsection{凸优化}
所谓的凸优化问题是指我们的目标函数和约束条件都是凸函数：
$$
{\displaystyle {\begin{aligned}&{\min_x}&&f(x) \\
&{\text{subject to}}&& g_i(x)\leq 0 \; i =1,\ldots, I\\
& &&A\mathbf {x} \leq \mathbf {b}\end{aligned}}} $$

其中$f(x)$和$g_i(x)$都是凸函数。

\subsubsection{线性规划}
线性规划（Linear programming,简称LP）是运筹学中研究较早、发展较快、应用广泛、方法较成熟的一个重要分支，它是辅助人们进行科学管理的一种数学方法。研究线性约束条件下线性目标函数的极值问题的数学理论和方法。
线性规划问题的标准形式：
$$
{\displaystyle {\begin{aligned}&{\min_x}&&\mathbf {c} ^{\mathrm {T} }\mathbf {x} \\&{\text{subject to}}&&A\mathbf {x} \leq \mathbf {b} \\& &&\mathbf {x} \geq \mathbf {0} \end{aligned}}}$$

\subsubsection{二次规划}

二次规划的一般形式可以表示为：
$$
{\displaystyle
{\begin{aligned}
&{\min_x}&&{\tfrac {1}{2}}\mathbf {x} ^{\mathrm {T} }Q\mathbf {x} +\mathbf {c} ^{\mathrm {T} }\mathbf {x} \\
&{\text{subject to}}&&{\displaystyle A\mathbf {x} \leq \mathbf {b} ,}\\
&  &&\mathbf {x} \geq \mathbf {0}
\end{aligned}}}$$
\\
其中:

$x$是一个$N$维决策变量

$Q$是一个$N\times N$维矩阵

$c$是一个$N$维向量

$A$是一个$J\times N$维矩阵

$b$是一个$J$维矩阵

\subsubsection{二阶锥规划}

一个二阶锥规划问题(SOCP)是指具有如下形式的图规划问题：
$$
{\displaystyle
{\begin{aligned}
&{\min_x}&&c^{T}x \\
& {\text{subject to}} &&Ax=b \\
&&&\lVert A_{i}x+d_{i}\rVert _{2}\leq c_{i}^{T}x+e_{i},\quad i=1,\dots ,I
\end{aligned}}}$$
\\
其中:

$c$是一个$N$维变量

$A$是一个$J\times N$的矩阵

$b$是一个$J$维向量

$C_i$是一个$I_i\times N$维矩阵

$d_i$是一个$I_i$维矩阵

$e_i$是标量

\subsubsection{整数规划}

整数规划是指规划中的变量（全部或部分）限制为整数，若在线性模型中，变量限制为整数，则称为整数线性规划。
\\
整数规划又分为：

1、纯整数规划：所有决策变量均要求为整数的整数规划

2、混合整数规划：部分决策变量均要求为整数的整数规划

3、纯0－1整数规划：所有决策变量均要求为0－1的整数规划

4、混合0－1规划：部分决策变量均要求为0－1的整数规划

\subsection{一个简单的优化例子:资产分配}

现在有一个资产管理者计划投资1千万美元于下面四种基金：
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{63.png}
\end{figure}

他对自己的投资分配有如下的限定：投资于任何一种基金的比例不超过 $40\%$、投资于基金1和基金3的金额 之和不超过总投资的$60\%$、平均的投资风险水平不能超过2。

我们假定 $x = (x_1,x_2,x_3,x_4)$表示投资于四种基金的金额。那么我们的目标函数可以写成：
$$f(x) = \mu^T x = (20.69\%)x_1+(5.87\%)x_2+(10.52\%)x_3+(2.43\%)x_4$$

我们的约束条件可以写成：

1.总的投资金额应该等于1千万美元：
$$x_1+x_2+x_3+x_4 =10,000,000$$

2.投资于基金1和基金3的金额 之和不超过总投资的$60\%$：
$$x_1+x_3\leq 6,000,000$$

3.平均的投资风险水平不能超过2:
$$\frac{4x_1+2x_2+2x_3+x_4}{x_1+x_2+x_3+x_4}\leq 2$$
由于$x_1+x_2+x_3+x_4 =10,000,000$,所以我们化简得到：
$$4x_1+2x_2+2x_3+x_4\leq  20,000,000$$

4.投资于各个基金的比例不超过 $40\%$:
$$x_1\leq 4,000,000,x_2\leq 4,000,000,x_3\leq 4,000,000,x_4\leq 4,000,000$$

5.当然，投资金额是非负的：
$$x_1\geq 0,x_2\geq0,x_3\geq 0,x_4  \geq 0 $$

最后我们的问题可以写成如下的形式：
$$ \max_{x_1,x_2,x_3,x_4}
 \begin{bmatrix}
    0.2069& 0.0587 & 0.1052&0.0243 \\
  \end{bmatrix}
\cdot
  \begin{bmatrix}
    x_1  \\
    x_2  \\
    x_3 \\
    x_4
  \end{bmatrix}$$
$$
 \begin{bmatrix}
    1& 1 & 1&1 \\
  \end{bmatrix}
\cdot
  \begin{bmatrix}
    x_1  \\
    x_2  \\
    x_3 \\
    x_4
  \end{bmatrix}=10,000,000$$
$$
 \begin{bmatrix}
    1& 0 & 1&0 \\
    4& 2 & 2&1 \\
    0& 0 & 1&0 \\
    0& 0 & 0&1 \\
  \end{bmatrix}
\cdot
  \begin{bmatrix}
    x_1  \\
    x_2  \\
    x_3 \\
    x_4
  \end{bmatrix}
  \leq
  \begin{bmatrix}
    6,000,000  \\
    20,000,000  \\
    4,000,000 \\
    4,000,000 \\
    4,000,000 \\
    4,000,000 \\
  \end{bmatrix}$$
  $$
  \begin{bmatrix}
    x_1  \\
    x_2  \\
    x_3 \\
    x_4
  \end{bmatrix}
  \geq
  \begin{bmatrix}
    0\\
    0\\
    0\\
    0
  \end{bmatrix}$$

\subsection{优化算法}
求解线性规划问题的基本方法是单纯形法。单纯形算法利用多面体的顶点构造一个可能的解，然后沿着多面体的边走到目标函数值更高的另一个顶点，直至到达最优解为止。虽然这个算法在实际上很有效率，在小心处理可能出现的“循环”的情况下，可以保证找到最优解，但它的最坏情况可以很坏：可以构筑一个线性规划问题，单纯形算法需要问题大小的指数倍的运行时间才能将之解出。事实上，有一段时期内人们曾不能确定线性规划问题是NP完全问题还是可以在多项式时间里解出的问题。

第一个在最坏情况具有多项式时间复杂度的线性规划算法在1979年由前苏联数学家Leonid Khachiyan提出。这个算法建基于非线性规划中Naum Shor发明的椭球法（ellip-soid method），该法又是Arkadi Nemirovski（2003年冯诺伊曼运筹学理论奖得主）和 D. Yudin的凸集最优化椭球法的一般化。

理论上，“椭球法”在最恶劣的情况下所需要的计算量要比“单形法”增长的缓慢，有希望用之解决超大型线性规划问题。但在实际应用上，Khachiyan的算法令人失望：一般来说，单纯形算法比它更有效率。它的重要性在于鼓励了对内点算法的研究。内点算法是针对单形法的“边界趋近”观念而改采“内部逼近”的路线，相对于只沿着可行域的边沿进行移动的单纯形算法，内点算法能够在可行域内移动。

1984年，贝尔实验室印度裔数学家卡马卡（Narendra Karmarkar）提出了投影尺度法（又名Karmarkar's algorithm）。这是第一个在理论上和实际上都表现良好的算法：它的最坏情况仅为多项式时间，且在实际问题中它比单纯形算法有显著的效率提升。自此之后，很多内点算法被提出来并进行分析。一个常见的内点算法为Mehrotra predictor-corrector method。尽管在理论上对它所知甚少，在实际应用中它却表现出色。
\subsection{优化软件}

matlab、python、c++、java 理论上都可以用于求解。

\subsection{一个求解的例子}
\subsubsection{Excel求解}

这里我采用的是matlab求解。代码如下：
\begin{lstlisting}[language=Matlab]
f=[-0.2069 -0.0587 -0.1052 -0.0243];
Aineq=[1 0 1 0;4 2 2 1;1 0 0 0 ;0 1 0 0 ;0 0 1 0 ;0  0 0 1];
bineq=[6 20 4 4 4 4];
Aeq=[1,1,1,1];
beq=10;
lb=[0 0 0 0 ];
%% Start with the default options
options = optimoptions('linprog');
%% Modify options setting
options = optimoptions(options,'Display', 'off');
options = optimoptions(options,'Algorithm', 'interior-point');
[x,fval,exitflag,output,lambda] = ...
linprog(f,Aineq,bineq,Aeq,beq,lb,[],[],options);
\end{lstlisting}


\subsubsection{求解结果}

运行上述代码得到求解的结果：
  $$x=\begin{bmatrix}
    2,000,000\\
    0\\
    4,000,000\\
    4,000,000
  \end{bmatrix}$$
$$fmax = 931,800$$
所以我们投资于四种基金的金额分别为：    2,000,000美元，0美元，
    4,000,000美元，
    4,000,000美元。
  一年后我们的预期收益为931,800美元。
\section{非确定优化}
\subsection{动态规划}

所谓的动态规划，是指在$t$时刻的动态系统的状态$x_t$依赖于过去的状态:
$$x_{t+1}=g_t(x_t,\mu_t,\xi_t)$$
其中，$\mu_t$是一个控制变量，$\xi_t$而是一个随机变量。

在金融领域，我们通常认为我们所研究的动态系统是有界的。我们记$f_t(x_t,\mu_t,\xi_t)$是一个动态系统在$t$时刻的代价（收益）。那么从0时刻到 $T$时刻，总的代价函数可以写成：
$$\sum_{t=0}^Tf_t(x_t,\mu_t,\xi_t)$$

如果我们想要最大化总的收益，相当于我们要选取 $\mu_t $使得:
$$V_t(x_t)=\max_{\mu_t}\{c(\mu_t)+d\cdot V_{t+1}(\mu_t)\}$$

（注：此处作者没有指明 $c(\mu_t)$表示什么意思，有点儿看不懂）

\subsection{随机规划}
\subsubsection{多级模型}

课本的写法过于简略并且又没有指明每个变量的意义。
这里结合wiki百科给出 Multistage Models 更为详细的介绍。

假设在 $t=0$时刻我们有资金 $w_0$。我们计划投资于 n件标的资产。令 $x_{0}=(x_{10},\dots ,x_{n0})$为初始的资金分配,$\sum\limits _{i=1}^{n}x_{i0}=W_{0} ,\; x_{i0} \geq 0 $ 。假设我们允许在 $t=1,\ldots T-1$ 时刻调整我们的资产分配。

令 $\xi _{t}=(\xi _{1t},\dots ,\xi _{nt}) $表示$t$时刻的资产回报率，$t=1,\dots ,T.$ 显然 $ \xi _{1},\dots ,\xi _{T}. $ 构成了一组随机变量。并且 $t$时刻的资产分配 $x_t$ 依赖于过去的信息。
或者说， $x_t$是$\xi _{[t]} $的函数：$$x_{t}=x_{t}(\xi _{[t]}) $$
其中$\xi _{[t]}=(\xi _{1},\dots ,\xi _{t})$是一组随机变量。并且对 $t=0,\dots ,T-1 $ 我们有：
$$\sum _{i=1}^{n}x_{it}(\xi _{[t]})=W_{0},$$

在 $t=1,\dots ,T $时刻资产的价值$W_{t} $为：
$$W_{t}=\sum _{i=1}^{n}\xi _{it}x_{i,t-1}(\xi _{[t-1]}),$$

假设我们的目标是最大化我们的总资产：
$$\max E[U(W_{T})].$$

显然，在 $t=T-1, $时刻，收益率 $\xi _{[T-1]}=(\xi _{1},\dots ,\xi _{T-1}) $是已知的。并且资产分配的权重 $x_{{T-2}} $也是已知的。那么，我们研究的问题就可以转化为：
$${\begin{array}{lrclr}\max \limits _{x_{T-1}}&E[U(W_{T})|\xi _{[T-1]}]&\\{\text{subject to}}&W_{T}&=&\sum\limits _{i=1}^{n}\xi _{iT}x_{i,T-1}\\&\sum \limits _{i=1}^{n}x_{i,T-1}&=&W_{T-1}\\&x_{T-1}&\geq &0\end{array}}$$

我们所优化的目标函数的最优值取决于 $W_{{T-1}}$和 ${\displaystyle \xi _{[T-1]}} $。我们把它记为 $Q_{T-1}(W_{T-1},\xi _{[T-1]}).$

同样的，在时刻 $t=T-2,\dots ,1,$ 我们的优化问题可以写成：
$${\begin{array}{lrclr}\max \limits _{x_{t}}&E[Q_{t+1}(W_{t+1},\xi _{[t+1]})|\xi _{[t]}]&\\{\text{subject to}}&W_{t+1}&=&\sum \limits  _{i=1}^{n}\xi _{i,t+1}x_{i,t}\\&\sum \limits _{i=1}^{n}x_{i,t}&=&W_{t}\\&x_{t}&\geq &0\end{array}}$$

而在 $t=0$时刻，我们的优化问题成为：
$${\begin{array}{lrclr}\max \limits _{x_{0}}&E[Q_{1}(W_{1},\xi _{[1]})]&\\{\text{subject to}}&W_{1}&=&\sum \limits  _{i=1}^{n}\xi _{i,1}x_{i0}\\&\sum \limits  _{i=1}^{n}x_{i0}&=&W_{0}\\&x_{0}&\geq &0\end{array}}$$

下图展示了一个简单的场景树例子：这里有三个阶段，两个待优化阶段。每一个节点表示资产的价格。例如，在 $t=0$时刻，资产的价格为5是一个确定值。在 $t=2$时刻，资产的价格有5种可能的结果。


\begin{figure}[htbp]
\centering
\includegraphics[width=4in]{721.png}
\end{figure}

给定上述场景树的情况下，我们可以按如下的步骤建立随机优化模型：

(i) 定义变量 $x_t^{(s)}$：$t$时刻出现$s$场景时资产的价格。在本例中 $x_0^0$表示第0阶段资产的价格， $x_1^{1},x_1^{2}$表示第二阶段资产的价格， $x_2^{1},\ldots x_t^{5}$表示第三阶段资产的价格。

(ii) 写出目标函数 ：
$$\max \sum_{i=0}^2\sum_s \pi_i^{(s)}c_i^{(s)}x_i^{(s)}$$

其中 $\pi_i^{(s)}$表示 $i$时刻出现 $s$场景的概率。

（iii）写出每个阶段的约束条件：
$$f_t(x_t^{(s)})=0 ~~ t = 0,1,2$$
注记：课本中以线性函数的形式给出了每一个阶段的约束条件，但是肯本没有说明$ A$，$B$表示的是什么意思。

那么，我们又是如何生成场景树的呢？通常来说又下面的四种方法：

1.从历史数据中自足抽样。

2.使用带参数的概率模型。

3.生成服从历史数据分布的数据。

4.采用自回归模型。

\subsubsection{风险中性随机模型}

假设现在有$N$件标的资产，回报率为 $\widetilde{r_1},\ldots,\widetilde{r_N}$。令 $w_1,\ldots,w_N$表示我们在$N$件资产中的投资比例。我们希望最大化我们投资组合的预期回报并且极小化投资组合的风险（方差）。假定未来资产回报率的情况有$S$种可能。比如，在情况$S$下，资产的回报率为：
$$\sum_{i=1}^{N}r_i^sw_i$$
我们用$\pi_1,\ldots,\pi_N$表示S种情形可能出现的概率：
$$\sum_{s=1}^{S}\pi_s = 1$$
令 $\mu_1,\ldots,mu_N$表示$N$种资产的预期回报率，那么总的期望汇报率为：
$$\sum_{i=1}^{N}\mu_iw_i$$

我们投资的总方差为：
$$\sum_{s=1}^{S}\pi_s(\sum_{i=1}^{N}r_i^sw_i - \sum_{i=1}^{N}\mu_iw_i)^2 $$

于是，我们可以定义我们的目标函数为：
$$\max_w \sum_{i=1}^{N}\mu_iw_i-k [\sum_{s=1}^{S}\pi_s(\sum_{i=1}^{N}r_i^sw_i - \sum_{i=1}^{N}\mu_iw_i)^2]$$

在这里 $k$为惩罚系数。通常 $k$由投资者自己给定。一般来说，投资者的风险厌恶程度越小，$k$的取值越小。

我们不妨讨论一个具体的例子：

下表展示了四种基金未来收益率可能出现的两种情况。我们假定情景1出现的概率为0.7，情景2 出现的概率为 0.3。

\begin{figure}[htbp]
\centering
\includegraphics[width=4in]{722.png}
\end{figure}

那么我们的目标函数就可以写成：
$$
{\begin{aligned}
&\max_w 20.69 w_1+ 5.87w_2 +10.52w_3+ 2.43w_4\\
-&0.3k(50.39w_1+ 15.69w_2 +23.29w_3+ 2.5w_4-(20.69 w_1+ 5.87w_2 +10.52w_3+ 2.43w_4))^2\\
-&0.7k(-9.02w_1-3.96w_2 -2.25w_3+ 2.36w_4-(20.69 w_1+ 5.87w_2 +10.52w_3+ 2.43w_4))^2
\end{aligned}}$$

\subsubsection{机会约束模型}

如果原始模型的约束条件为：
$$a^{T}x\leq b$$

那么机会约束模型的约束条件就可以写成：

$$\Pr(a^{T}x)\leq \varepsilon$$

显然，一个概率约束模型不是 一种标准的优化公式，我们需要将上述的条件进一步写成可以计算的问题。
我们假定我们的资产有 $S$ 种不同汇报的情景。我们可以把约束条件写成 ：
$$
{\begin{aligned}
a^s x &\leq b +My_s ~ s= 1,\ldots,S \\
\sum_{s=1}^{S}y_s &\leq [\varepsilon S] \\
y_s & \in{0,1}~  s= 1,\ldots,S
\end{aligned}}$$

其中 $M$是由投资者给出的常数（通常很大）。

当 $y_s=0$时，我们需要满足如下的约束条件：

$$a^s x \leq b +My_s ~ s= 1,\ldots,S  $$

当 $y_s=1$时，由于 $My_s $很大，我们的问题成为一个无约束问题。

而附加条件 ：
$$\sum_{s=1}^{S}y_s \leq [\varepsilon S]$$约定了1最多出现的次数。

例如，我们预期的资产汇报有115种可能，并且我们的置信度为 $\varepsilon=5\% $,那么我们允许出现最多 $[0.05*115]=5$个1。也就是说，我们在 $95\%$的情况下是不违背约束条件的。

如果 $x$服从正态分布，那么我们的约束条件可以写成：
$$a^s x +q_{1-\varepsilon }\sqrt{x^T\Sigma x}\leq b  $$
这是一类二阶锥规划问题，那么我们该如何求解呢？鲁棒优化给出了很好的答案。

\subsection{鲁棒优化}
在随机规划中我们常常难以确定数据所服从的概率分布。鲁棒优化引入一个不确定集来帮助我们解决上述问题。鲁棒优化不同于线性规划，鲁棒优化的系数是一个不确定的集合，其目的是在最糟糕的条件下为目标函数找到一个最优解。

例如，考虑线性约束问题：
$$\widehat{a}^T x \leq b$$
其中随机变量 $\hat{a}=(\hat{a}_1,\ldots,\hat{a}_N) $,其$95\%$的置信区间为：$(a_i-\delta_i,a_i+\delta_i) ,i=1,\ldots,N$。

记：
$$U_{\delta}(\widehat{a})=\{a| |a-\widehat{a}_i|\leq \delta_i,i=1,\ldots,N\}$$
鲁棒优化的目标函数可以写成：
$$\max_{a \in U_{\delta}(\widehat{a})} {a^Tx\leq b}$$

可以将上诉式子写成一个易于求解的公式：
$$a^Tx+\delta^T|x|\leq b$$

在求解实际问题中，我们常常不需要将所有的系数都取到最糟糕的情况，由于我们容易获得系数的标准差和期望。我们常常采用经典的椭圆不确定集合：
$$U_{\delta}(\widehat{a}) =\{a|(a-\widehat{a})^T\Sigma^{-1}(a-\widehat{a}) \leq \delta ^2\}$$
等价地，我们可以写成：
$$U_{\delta}(\widehat{a}) =\{a| ~||\Sigma^{-\frac{1}{2}}(a-\widehat{a}) ||\leq \delta\}$$
于是，鲁棒优化问题：
$$\widehat{a}^T x \leq b$$
可以被化成：
$$\widehat{a}^T x +k||\Sigma ^{\frac{1}{2}x}|| \leq b$$
这就转化成了一个可以求解的规划类问题了。

\section{资产多样化}

分散风险(Diversification)
在证券投资上，是指将资金分配在多种资产上，
而这些资产的回报率相互之间的关联性比较低，以达分散风险的目的。这样做既可以降低风险，又不会损及收益。推出的各种银行、理财和基金系统的QDII产品为中国投资者提供了投资全球、分散风险和资产配置的更多选择。

\subsection{资产分散的例子}

假设有一个投资者计划投资两只股票（股票1和股票2），两种股票的回报率为：
$$
{\begin{aligned}
E(r_1)=&\mu_1=9.1\%\\
E(r_2)=&\mu_2=12.1\%
\end{aligned}}$$

两种股票的标准差：
$$
{\begin{aligned}
\sigma_1=16.5\%\\
\sigma_2=15.8\%
\end{aligned}}$$

很明显，第二只股票的表现要优于第一只股票，因为第二只股票的收益率比较高并且方差比较小。

现在我们假定两只股票的相关系数$\rho_{12} = -0.22$,设$w_1,w_2$为投资与两只股票的权重。
我们总的投资回报率为：
$$r_p=w_1r_1+w_2r_2$$

容易得到：
$$E(r_p)=w_1\mu_1+w_2\mu_2$$
$$\sigma_p^2=Var(w_1r_1+w_2r_2)=w_1^2\sigma_1^2+w_2^2\sigma_2^2+2w_1w_2\sigma_1\sigma_2\rho_{12}$$

显然，我们的投资组合的均值和方差是随着$w_1,w_2$而变化的，我们可以从下图看到这一现象。
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{81.png}
\end{figure}

在我们的这个例子中，具有负相关的两只股票显著地降低了投资的风险。然而，当两只股票不相关或者弱相关的时候这一效应就没有那么显著了。我们选取了标普500中的25只股票计算了这一个投资组合在过去12个月的表现（先选1只，依次增加）可以看到，随着股票数目的增加，投资的方差在减少，但是其减少的速度是递减的。
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{812.png}
\end{figure}


\subsection{经典均值方差优化模型}

假设一个投资者计划投资于N个标的资产。投资的权重$w=(w_1,\ldots,w_N)$。并且$\sum\limits _{i=1}^Nw_{i}=1.$。 那么预期的投资回报：
$$\operatorname {E} (r_{p})=\sum _{i=1}^Nw_{i}\operatorname {E} (r_{i})\quad=\mu^Tw $$

方差：
$$\sigma_p^2=w^{T}\Sigma w$$

其中 $\Sigma$是协方差矩阵。

如果N只股票的相关系数矩阵为：
$$
\begin{aligned}
C&=
 \begin{bmatrix}
    1& \ldots & \rho_{1N} \\
    \vdots &  & \vdots \\
    \rho_{N1} &\ldots & 1
  \end{bmatrix}
\end{aligned}
$$

那么协方差可以写成：
$$\sigma_p^2=(w^{s})^T C w^s$$

其中$w^s=(w_1\sigma_1,\ldots,w_N \sigma_N)$

对于 $N=2$的情况：
$$E(r_p)=w_1\mu_1+w_2\mu_2$$
$$\sigma_p^2=w_1^2\sigma_1^2+w_2^2\sigma_2^2+2w_1w_2\sigma_1\sigma_2\rho_{12}$$

经典的均值-方差优化问题可以写成：

$${\begin{aligned}
\min_w ~~~& w^{T}\Sigma w\\
s.t.~~&w^T\mu=r_{target}\\
&w^T\mathbf{1}=1
\end{aligned}}$$

其中$\mathbf{1}=(1,...,1)_{1\times N}$
这是一个凸二次规划问题。构造拉格朗日乘法：
$$L=w^{T}\Sigma w+2\lambda (\mu -w^{T}r_{target})+2\eta (1-w^T\mathbf{1}),$$

令 $\frac{\partial T}{\partial w}=0,\frac{\partial T}{\partial \lambda}=0,\frac{\partial T}{\partial \eta}=0$ 解得：

$$w^{{\mathrm  {opt}}}={\frac  {1}{\Delta }}[(\mu^{T}\Sigma^{{-1}}\mu)\Sigma^{{-1}}\mathbf{1}-(\mathbf{1}^{T}\Sigma^{{-1}}\mu)\Sigma^{{-1}}\mu]+{\frac  {r_{target} }{\Delta }}[(\mathbf{1}^{T}\Sigma^{{-1}}\mathbf{1})\Sigma^{{-1}}\mu-(\mu^{T}\Sigma^{{-1}}\mathbf{1})\Sigma^{{-1}}\mathbf{1}]$$

其中：
$$\Delta =(\mu^{T}\Sigma^{{-1}}\mu)(\mathbf{1}^{T}\Sigma^{{-1}}\mathbf{1})-(\mu^{T}\Sigma^{{-1}}\mathbf{1})^{2}>0.$$

\subsection{有效边界理论}
有效边界是在收益―风险约束条件下能够以最小的风险取得最大的收益的各种证券的集合。如图所示。
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{83.png}
\end{figure}

图中，横座标表示风险，纵座标代表收益，阴影中的任意一点代表一种可行的组合证券，每一组合证券所提供的风险―收益组合可以通过横、纵座标上相应的两点予以确定。很明显，图中曲线上的各点代表的各种组合证券所对应的风险一收益组合远较阴影部分中其他各点代表的组合证券为优，因为它们能够在风险最小的情况下取得最大的收益;或者说，为取得一定收益而承受的风险最小，承受一定风险所获得的收益最大。曲线代表着证券投资的有效边界

\subsection{经典均值方差优化模型}
\subsubsection{预期回报公式}

如果我们想要最大化投资组合的回报率，我们可以把优化问题写成：
$${\begin{aligned}
\min_w ~~~&w^T\mu  \\
s.t. ~~~&w^{T}\Sigma w =\sigma_{target}^2\\
&w^T\mathbf{1}  =1
\end{aligned}}$$

这是经典的均值方差优化模型，它将我们的风险限制在一定的水平下。我们会在第10章详细讨论。

\subsubsection{风险厌恶公式}

对于一个风险厌恶的投资者，他更加希望其投资组合不应该承受太多的风险。我们常常采用惩罚函数的方式来实现这一目标。
$${\begin{aligned}
\min_w ~~~&w^T\mu - \lambda w^{T}\Sigma w\\
s.t. ~~~& w^T\mathbf{1}  =1
\end{aligned}}$$

其中的$\lambda $被称为风险厌恶系数。

\subsection{资本市场线}
资本市场线(Capital Market Line，简称CML)是指表明有效组合的期望收益率和标准差之间的一种简单的线性关系的一条射线。它是沿着投资组合的有效边界，由风险资产和无风险资产构成的投资组合。
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{85.png}
\end{figure}

设$r_f$表示无风险收益率，令$w=(w_1,...,w_N)$表示投资于N件风险资产的权重，$r=(r_1,...,r_N)$表示投资预期收益率。容易知道我们总的资产回报率为：
$$ w^Tr+(1-w^T)r_f$$

方差为：
$$w^T\Sigma w$$

均值方差优化模型可以写成：
$${\begin{aligned}
\min_w ~~~&w^T\Sigma w\\
s.t. ~~~& ^Tr+(1-w^T)r_f =r_{target}
\end{aligned}}$$

可以得到最优解为：
$$w=C\Sigma^{-1}(r-r_f\mathbf{1})$$
其中：
$$C=\frac{r_{target}-r_f}{(r-r_f\mathbf{1})^T\Sigma^{-1}(r-r_f\mathbf{1})}$$

如果我们的目标是最大化夏普比率,那么我们的目标函数可以写成：
$${\begin{aligned}
\max_w ~~~&\frac{w^Tr-r_f}{w^T\Sigma w}\\
s.t. ~~~& w^T\mathbf{1}=1
\end{aligned}}$$

上述问题的解为：
$$w^M=\frac{1}{\mathbf{1}^T\Sigma(r-r_f\mathbf{1})}\Sigma^{-1}(r-r_f\mathbf{1})$$

\subsection{期望效用函数理论}
如果某个随机变量$W$以概率$p_i$取值$w_i，i=1,2,…,n，$而某人在确定地得到$w_i$时的效用为$u(w_i)$ 那么，该随机变量给他的效用便是：
$ E[u(W)] $。
对于投资类问题，设 $u$是投资者的效用函数， $W_0$表示期初的资产，$W$表示期末的资产，投资者的目标是最大化$E[u(W)]$，那么投资者的效用优化问题可以写成：
$${\begin{aligned}
\max_w ~~~&E(u(W_0(1+w^Tr)))\\
s.t. ~~~& w^T\mathbf{1}=1
\end{aligned}}$$

下面给出一些常见的效用函数。

\subsubsection{二次效用函数}

二次效用函数的形式为：
$$u(x)=x-\frac{b^2}{2}x^2,b>0$$

容易计算得到：
$$E(u(W_0(1+w^Tr)))=u(W_0)+W_0\mu_P(1-bW_0)-\frac{b}{2}W_0^2(\sigma_p^2-\mu_p^2)$$

其中$\mu_p,\sigma_p$表示收益的均值和方差。

\subsubsection{线性效用函数}
$$u(x)=a+bx$$
$$E(u(W_0(1+w^Tr)))=a+bE(W)$$


\subsubsection{指数效用函数}
$$u(x)=-\frac{1}{a}e^{-ax}$$

虽然指数效用函数是负值函数，但是这没有关系，因为他是严格递增的函数。

\subsubsection{幂效用函数}
$$u(x)=ax^a,0<a \leq 1$$

\subsubsection{logistic效用函数}
$$u(x)=ln(x)$$

\subsubsection{再定义多样化}
马科维茨的资产多样化理论在实际的场景中很难被使用，主要的原因是预期回报率通常是难以确定的。
Choueifaty在2008年提出了如下的指标用于衡量资产的多样化比例。

资产多样化比例(DR)
$$DR(w)=\frac{w^T\sigma}{\sqrt{w^T\Sigma w}}$$

其中 $\sigma$是投资标的的标准差。当 $DR(w)=1$时表示投资于单一品种。多样化的投资应该使得
$DR(w)>1$。例如，等权重的投资组合 $DR(w)=\sqrt{N}$。第$i$件投资标的的风险占总投资风险的比例可以采用如下的计算公式：
$$RC_i(w)=\frac{\partial\sigma(w)}{\partial w}=\frac{w_i(\Sigma w)_i}{\sigma(w)}$$

其中 $(\sigma w)_i$是 $\sigma w$的第i个元素。这样的定义保证了总的投资风险为$\sigma(w)$。一个风险平价投资组合相当于一个等权重的投资组合：
$$RC_i(w)=\frac{\sigma(w)}{N}$$

Mailland在2010年考虑了如下的优化问题：
$$\min_{w>0} f(w) = w^T\Sigma w-\sum_{i=1}^N ln(w_i)$$

这是一个 优化领域的著名问题，采用内点法可以求解。近年来，多种多样的资产优化问题被提出，读者可以参考相关文献。

\section{因子模型}


\subsection{金融经济学文献中的因子模型}

线性因子模型代表了应用于金融中的绝大多数因子模型：

$${\displaystyle r_{i}=\alpha _{i}+f _{1}\beta_{i1}+\cdots +f _{p}\beta_{ip}+\varepsilon _{i} \qquad i=1,\ldots ,n,}$$

$r_i$:第i份资产收益率

$f_k$：影响因子

$\beta_{ik}$:回归系数（灵敏度）

$\alpha$:常数

$\varepsilon _{i} $随机扰动

最简单的线性因子模型一单一指数模型,是Markowitz(1959)为简化均值一方差投资组合分析的目标而提出的。虽然马科维茨在其著作的脚注中提到了这个方法，但Shape(1963)进一步研究了这一方法。这个模型包含一个称为指数的单一因子。 理论上，该指数是经济中所有资产的价值加权投资组合，其中“价值加权”意味着投资组合中 每种资产回报的权重代表了该资产的市值(发行股数乘以每股价格）在经济中所有资产的总 市值的份额。在实践中，几个宽基指数(如标普500 指数)都得到使用。假定因子是市场指数 (类如标普500指数)回报的模型称为单一指数市场模型。

在单一指数市场模型中，相对于市场变化的证券的敏感度(证券的贝塔值)是利用简单线 性回归从一组观察到的证券回报和市场回报中估计得到的:

$$r_i=\alpha_i+\beta_i+r_M+\varepsilon _{i}$$

$r_i$:第i份资产收益率

$r_M$：市场组合的回报

$\beta_{ik}$:回归系数（灵敏度）

$\alpha_i$:证券i特有的回报

$\varepsilon _{i} $随机扰动

单一指数模型有三个假设：

（1）模型中的所有随机变量都有有限的均值和方差

（2）市场指数的随机回报与证券的随机误差项之间的协方差为零。

（3）任何两个证券i，j回报的特有部分的协方差是零

我们可以得到,对 $\forall i\neq j$:
$$Cov(r_i,r_j)=Cov(\beta_ir_M,\beta_j r_M)=\beta_i\beta_j\sigma_M^2$$

上面的式子表明如果我们的假设是正确的，那么投资组合的风险仅仅由贝塔系数决定！

本章的的后续讨论了Capm模型，但是笔者认为假设条件过于强，所以没有特定写出。

\subsection{因子模型的均值方差优化}

考虑一个具有N个资产的投资组合，其期望回报向量$\mu=(\mu_1,...\mu_N)$，回报协方差矩阵为$\Sigma$。 如果资产的权重是$W=(w_1,w_2,...w_N)$那么回忆第8章，投资组合期望回报和方差可以分别写成$\mu^T w$和$w^T\Sigma w$。

为了在不使用因子模型的情况下，计算出必要的输入信息以估计一个具有N个证券的 投资组合的风险(定义为投资组合方差），那么人们需要发现N个证券的协方差矩阵。这将 需要估计N个方差(N个证券中的每一个证券都有一个方差)和N(N ― 1)/2个协方差。 人们还需要估计N个期望回报。总计需要2N + N(N ― 1)/2 个估计。

假设投资组合经理正在考虑构建一个投资组合，并且投资组合有1000个候选证券（即 N = 1 000)。为了计算投资组合，投资组合经理需要估计1000个方差和499 500 协方 差。加上1000个期望回报的估计，总共需要对501500个值进行估计，这是一个非常艰难的 任务。除了准备用于估计的数据是困难的之外，估计也将是不稳定的。在时间上，一个证券 对特定因子的敏感性可能比该证券对拱资组合中其他证券的敏感性更加稳定。如果使用基 于证券之间直接关系的协方差估计，那么来自投资组合优化流程的输出值将是不可靠且不稳 定的。输入参数的一个微小变化可能导致最优投资组合配置的大幅波动。

现在假设投资组合经理希望从N个证券中构建一个投资组合，并且N个证券回报的向量可以通过因子模型表示：

$$r=\alpha^Tw + B f + \varepsilon$$

$r$：预期收益率

$f$:K维因子向量

$B$:$N\times K $维因子载荷矩阵

$\varepsilon $N维残差

投资组合收益率的期望：

$$E(r)=\alpha^Tw + B E(f) $$

投资组的方差：

$$w^T(B\Sigma_fB^T+\Sigma_{\varepsilon})w$$

其中  $\Sigma_f$是因子的协方差矩阵。$\Sigma_f$是对角残差矩阵。

假设投资组合便用单一指数模型来估计输入信息。那么，一个含有N个证券的投资组备将需要估计以下参数以便进行均值一方差优化：

N个阿尔法来计算期望回报。

N个贝塔来计算期望方差和协方差。

1个指数方差$\sigma_M^2$的估计来计算方差和协方差。

N个残差的方差


总共是3N+1个估计。对于一个具有1000个候选证券的投资组合，这
转换成3001个估计，比不使用因子模型的501500个估计更加易于操作。假设投资组合经理使用具有K因子的模型，逻辑是类似的，只不过需要估计：


N个矩阵中每一个证券的K个因子载荷

K(K-1)/2个因子协方差

K个因子方差

N个残差的方差


\subsection{实践中的因子选择}

一般地，因子模型中使用的经验因子分为以下三类：

（1）外部宏观经济因子，如国内生产总值(GDP)、消费者价格指数(CPI)、,失业率、债券信用息差，以及收益率曲线的陡峭度。

（2）基本面因子（公司特征），如市盈率，股息支付率盈利增长预测和财务杠杆

（3）提取的统计因子，例如市场投资组合的回报率特定行业(公用事业、交通、航空航天)股票回报率的平均值等。

下图展示了将资产类型分解成为 因子的案例
\begin{figure}[htbp]
\centering
\includegraphics[width=4in]{93.png}
\end{figure}


\subsection{阿尔法构建中的因子模型}

几十年来，构建阿尔法一直是主动量化投资管理的核心.主要思路是识别带来出色绩效 的回报（因子)的经验动因。



在实践中，构建阿尔法的过程开始于观察到的现象或信号，例如“小盘股优于大盘股”“低波动股票优于高波动股票”“每股收益高的公司优于每股收益低的公司”。在每一个这些观察 到的例子背后是一个因子(规模、波动性、每股收益），投资组合经理试图用因子模拟投资组合来描绘这个因子。

我们来抽象化这一问题，
令 B为因子载荷矩阵，$\alpha$是包含阿尔法信号的向量，那么优化问题可以写成：
$${\begin{aligned}
\min_w& w^T\Sigma w\\
s.t.& B^Tw=0\\
& \alpha ^Tw = 1
\end{aligned}}$$

\subsection{因子模型用于风险评估}

\subsubsection{宏观经济因子模型}

逻辑上，资产回报率应该收到宏观经济的影晌。例如，如果美联储削减利率，债券和股票市场都会做出反应。原因是当利率降低时，投资者需要较低的投资回报率。较低的必要回报率一般带来证券价值的升值。

宏观经济模型中的每个因子的每个贝塔系数通常根据时间序列回归方程来估计：

$$r_{it}=\beta_{i1}f_{1t}+\cdots +\beta_{iK}f_{1K}+\varepsilon$$


\subsubsection{基本面因子模型}

基本面因子模型依赖于基本面研究――梳理行业和个体公司数据以找到具有市场价值 的公司特征。这样的公司特征可能与公司估值或投资者期望有关，并且通常称为风格因子。包括公司规模、财务比率(如市盈率)、股息率、动量、增长、财务杠杆、收益变动和波动性。行业因子(例如，证券的发行人属于哪个行业类别)是组成基本面因子模型部分的另一 组因子。通常，出于建模目的，为了处理多重共线性效应并提高模型的解释力，常常使用风险 指数。这些风险指数是基本面因子的汇集，而不是单一财务比率。

基本面因子模型中的每个因子的每个贝塔系数通常根据时间序列回归方程来估计：

$$r_{it}=\beta_{i1}f_{1t}+\cdots +\beta_{iK}f_{1K}+\varepsilon$$

\subsubsection{统计因子模型}

在数学上，证券收益率的协方差矩阵的主成分通过分解协方差矩阵 $\Sigma $来提取：

$$\Sigma = P A P^T$$

其中 P是正交矩阵。

主成分分析的结果可以被认为是不相关的N个投资组合，此外，主成分分析可以帮助降低维度。如果最终选取了K个因子，那么模型解释的方差占比：

$$\frac{\sum_{k=1}^K \lambda_k} {\sum_{k=1}^N \lambda_k}$$

一个确定隐含的统计因子的替代技术是因子分析。当基本因子模型的理论基础存在时， 因子分析比主成分分析更为合适。因子分析通常使用回归来估计因子载荷矩阵，因此证券回报可以表示为:

$$r=\alpha^Tw + B f + \varepsilon$$

其中$\alpha$是回报的N维向量，f是因子的K维向量，B是因子载荷的$K\times N$矩阵，e 是残差的N维向量。需要估计的协方差矩阵可以假设为：

$$\Sigma = B B^T+\Sigma_{\varepsilon}$$

估计过程分为两个步骤。第一步中，通过线性回归或最大似然估计法来估计协方差矩阵 和因子载荷。第二步中，使用协方差矩阵和因子载荷来估计因子。在每个时间点t的因子估计为：

$$f_t=(B^T\Sigma_{\varepsilon}^{-1}B)^{-1}B^T\Sigma_{\varepsilon}^{-1}(r_t-\alpha)$$

\subsubsection{混合因子模型}

如今几个因子模型供应商都提供混合因子模型。这些模型使用传统的因子组(货币、行业、国家等)来尽可能多地解释回报的不定性，然后使用统计因子(通过主成分分析获得)吸收因子模型中的剩余风险，即因子模型误差项中剩余的不定性。

一方面，使用基本面宏观经济因子模型为风险和投资组合管理提供了背景，另一使用统计因子模型使得捕获残差回报中的任何剩余隐藏因子得以可能。因此，混合因子模型试图做到两者最好:它对模型强加了 一些结构设置，但也从数据中挖掘那些在理论模型中无法得到的附加信息。

\subsubsection{选择“适合的”因子模型}

如前所述，许多资产管理公司使用软件供应商提供的因子模型。“基本面”因子模型仅使用公司的基本面信息。“全球”因子模型纳人了关于世界货币和利差的信息。“混合”因子模 型将基本面和/或宏观经济因子模型与统计因子模型相结合。

那么哪个因子模型是“最好的”呢？这没有单一的答案，但投资组合经理的投资策略细节 可以缩小选择。

首先，投资经理应选择一个能涵盖其投资领域的因子模型:单一国家、地区或全球。这是 因为全球因子模型考虑了区域投资时不那么重要的货币和其他因子。

第二，投资经理应该考虑投资组合的投资时限。供应商因子模型通常具有目标时限―― 短期、中期或长期，其中投资时限是投资组合的平均周转时间。不同的因子在短期内和长期 内是不同的。短期因子模型更适食期限为一天至两个月的投资者，例如对冲基金。长期时限 是指长于一年的投资期，中期时限是指介于短期和长期之间的任何时限。

\subsection{数据管理与质量问题}

\subsubsection{数据调整}

数据通常存储在多个数据库中需要合并才可以进行分析。
合 并来自不同数据库的数据可能是非常具有挑战性的。例如，有时不同数据库为同一公司使用 不同的标识符，使得难以对应记录。即使使用诸如CUS1P或股票代码之类的公共标识符，后 者也可能随时间而改变，并且有时会因为公司不苒存在于数据库中而被重新使用，因此可能 难以跨数据库正确地连接所有公司。，

数据调整中的一个更微妙的问题是，困为数据的差异，但基于不同变量的数据记录，用不同的方法来计算模型输入信息，可能会导致不一致的估计。Faboi、Focardi和Kolm 展示了两个替代但等价的方法来计算一个基本面因子(EBITDA/EV)，数据来源是Capital IQ Compustat Point-In-Time数据库中的记录两种方法得出非常不同的EBITDA/EV估 计。这两种方法的不同在于用于计算分母(EBITDA)的数据不同：

方法一:EBITDA=销货D销货成本-销货和一般管理费用

方法二:EBITDA=未许折旧前的经营收入

二者的关系：

未计折旧前的经营=销货-=销货成本-销货和一般管理费用

然而，从数据库中提取数据不是一祥的Fabozzi列出了
这种数据不一致的多种原因。首先，可能存在四舍五人和轻微误差。第二，记录中可能有错
误。第三，有时不同的数据项被结合在一起。有时旧和摊销费用不是损益表上的单 独项目；而是包括在销售商品的成本中。第四，数据项可能在不同的公司、部门或行业中报告 不一致当财务数据提供者不正确地将财务指标从公司报告映射到特定数据库项目时，也会发生这种情况。

\subsubsection{幸存者偏差}

如果当公司不再存在而从数据库中删除，并且只有还运行的公司的数据被用于分析时，幸存者偏差(survival bias)便会发生。（公司可能因不同的原因而不再存在，例如破产或合 并。)幸存者偏差导致错误的分析。只关注幸存者和忽略那些不再存在的公司，都可能会在分 析中忽略重要的信息。通过下面的例子可以理解这个问题。假设一个人将在比较2005年 3 000家最大(最高市值)的公司与2015，3 000家最大的公司后发现，3 000家最大公司的价 值上升了 40$\%$。有人可能会认为，包括这些公司在内的投资组合的回报率是40$\%$。然而， 如果一些在2005年存在的公司不再存在(或不在2015年3000家最大公司的名单上)，那么实际上是无法构建包含最大公司的投资组合的！！

\subsubsection{前视偏差}

在预测模型中使用在预测发生时还没有的数据，就会发生前视偏差。例如，假设将年终收益用作1月份回报预测模型中的一个因子这些间报在年度结束后至少 一个月后才会公布。因此，它们不能用于预测1月份的收益。它们不可能在1月初获得。 如果使用回填和重述，前视偏差可能变得更糟。回填(backfilling)是将先前丢失的数据在收到后输入数据库，这可能发生在比必须使用该信息以用于预测的时间晚很多。重述(restatement)发生于(例如）当公司修改了其最初发布的财报时。许多数据库公司(例如，Capital IQ) 会覆盖最初记录的数字。然而，如果将信息用于预测模型，则只有原始数字可获有。使用更 新的信息来构建预测模型引入了偏差，因为它不能正确地反映在需要做出投资决定时可用的 信息！


\subsubsection{数据迁就}

数据迁就是在数据中发现“模式”，即使这些模式实际上并不存在。当人们不能进行控制 实验而必须依靠记录的数据和统计推断来寻找模式时，这个问题尤其突出。这正是金融数据 的情况。

拥有足够的时间和足够的数据，人们可以找到想找到的任何数据模式。因此，确保投资 组合经理使用的任何分析模型都建立在合理的经济理论和常识基础上，而不仅仅是经验证据，是非常重要的。

\subsection{风险分解、风险归因和业绩归因}

风险分解就是将投资组合方差根据是否持有或风险类型分解为个体贡献在使用因子 模型进行风险分解的情况下，人们确定投资组合对因子模型中不同因子的风险敞口。

\subsection{因子投资}

因子模型自20世纪70年代以来就一宜存在，并用于阿尔法构建和风险管理环境

因子投资策略――有时称为聪明贝塔、科学贝塔、基于因子的投资或基本面指数化有巨大的多样性，但它们所共有的是对历史表现良好或投资经理认为可能继续增加风险调整后回报的因子的持续敞口。因子投资已经改变了特定资产类别中的传统资产分配和投资组合选择。

在传统的资产配置策略中，投资组合在不同资产类别之间是多元化的(例如，60/40投资组合将包含投资于股票的资金为60$\%$和债券为40$\%$)。然而，这样的投资组合不一定能够很好地多元化――资产类别之间的相关性往往很高，并且实际上市场困难时会爆发。例如，在 “正常”的市场，如2009―2014年期间，美国大盘股与标普500指数完全相关;美国中盘股与标 300指数的相关系数为0.96;美国小盘股与标普500指数的相关系数为0.93。根据晨星机构 的数据，在2008~2009 年金融危机后，这些相关性分别为1.00、0.97和0.96。同样高的相关和相同的现象也可见于发达和新兴的股票市场。

更缜密的投资方法可能需要将资产类别分解成可以解释其相关性和回报/风险特征的共同因子。例如，贝莱德(BlackRock)――一个聪明贝塔产品的供应商，识别出6个跨越不同资产类别的因子:经济(与经济增长不确定性相关的风险信用(违约风险）、实际利率(暴露于实际利率变化的风险）、通货膨胀(暴露于价格变化的风险)、新兴市场(政治动荡的风险)和流动性(在特定时间无法卖出投资的风险通过将投资配置到这些因子而不是资产类别，投资 可以避免因资产类别的因子敞口重叠而导致的风险集中。因子本身显示较低的相关性， 投资组合更好的多元化。下图显示贝莱德所确定的因子之间的相关性。

\begin{figure}[htbp]
\centering
\includegraphics[width=4in]{98.png}
\end{figure}

\section{投资组合构建的基准和跟踪误差的使用}


\subsection{跟踪误差与阿尔法计算与阐释}

正如我们在本章介绍中所提到的，跟踪误差衡量的是投资组合回报相对于指定基准回报的离差。数学上将跟踪误差并算为：

主动回报=投资组合的实际回报-基准的实际回报

如果一个被构建以定期与基准匹配的投资组合,如指数基金,具有零主动回报(即总是匹配基准的实际回报）,则其跟踪误差为零。但是如果是一个主动型管理的投资组合，并且持有与基准非常不同的仓位，那么它很可能会有相当大的或正或负的主动回报，因此将具有年化跟踪误差如$2\%-5\%$。

考虑一个投资组合,它在半个月内比基准指数高10个基点，
并在另一个半月比基准指数低10个基点。由于主动回报中存在变化，该投资组合将具有正的跟踪误差。但因为没有实现主动回报，在这种情形下投资组合的阿尔法将为零。下表显示了使用一个假设的投资组合和基准的12个月的观测值来计算跟踪误差所必需的信息。

表中的第四列显示了该月的主动回报。月度主动回报的均值(平均值)和标准差分别为$0.21\%$和$0.96\%$

\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{101.png}
\end{figure}

为了对时间长度为年的平均回报率进行年化计算，可将平均回报乘以$t$例如，要年 化平均月度回报(计算时间为$1/12$年)，可将平均月度回报乘以一年中的月数(12):

为了对时间长度为$1/t$年的回报计算年化标准差，可将标准差乘以$t$的平方根。例如，要年化月度回报的标准差，可将月度标准差乘以一年中月数的平方根。

要计算案例中的年平均主动回报率(阿尔法)，我们将月度主动回报$(0.21\%)$乘以一年中 的月数(12)年化主动回报率是:

阿尔法 = $(0.21\%)\cdot (12) = 2.47\%$

要计算年化跟踪误差，将每月标准差乘以以一年中月数的平方根。因此：

年化跟踪误差= $(0.96\%)\cdot (\sqrt{12}) = 3.34\%$

如果可以假设主动回报服从正态分布，那么就可以估计投资组合主动回报的可能范围， 以及给定跟踪误差下的投资组合回报的相应范围。例如，假设如下：

基准=标普500指数

标普500指数的期望回报=$20\%$

相对于标普500指数的跟踪误差=$2\%$

如果主动名义回报服从正态分布，则其分布在平均回报的一个标准差内，$95\%$将落 距平均回报的大约两个标准差内，$99\%$将落在距平均回报的大约三个标准差内。给定关于正态分布的这些众所周知的事实 可以估计投资组合回报如下：

有$68\%$的机会在标普500指数的期望回报的一个标准差内

有$95\%$的机会在标普500指数的期望回报的两个标准差内

有$99\%$的机会在标普500指数的期望回报的三个标准差内

\subsection{前视和回望跟踪误差}

在上面的表格中，我们展示了基于投资组合12个月实际主动回报的跟踪误差的计算。投资组合所实现的业绩是投资组合经理在12个月内对投资组合定位问题的决策结果，例如贝塔、板块配置、风格偏好(价值型与成长型)，以及单个证券选择。从历史主动回报结果的这种方式来计算跟踪误差称为回望跟踪误差、事后跟踪误差和实际跟踪误差。

回望跟踪误差虽然在投资组合绩效评估中有用，但缺乏预测价值，并且在评估投资组合 风险时可能会产生误导。这是因为它不反映投资组合经理的当前决定(例如，板块配置的变化）可能将对未来主动回报和跟踪误差产生影响。

\subsection{跟踪误差与信息比率}

信息比率(IR)是一种广泛使用的风回报绩效指标。计算公下

$$\text{信息比率}=\frac{\text{阿尔法}}{\text{回望跟踪误差}}$$

IR本质上是回报――风险比。IR越高，管理者相对假设风险的绩效越 好。IR还试图衡量一致性。一个高IR 比率表示投资组合经理每个月都比基准指数略胜一 筹(而不是在几个月的时间里休胜很多)。绩效的一致性被认为是投资组合经理的理想特征。

为了说明IR的计算，考虑上表中假设的投资组合的主动回报。该投资组合的年化平均主动回报率为$2.47\%$: 回望跟踪误差$3.34\%$。因此,信息比 率为 0.74.

\subsection{跟踪误差预测的计算}

\subsubsection{跟踪误差计算中的方差――协方差方法}

在给定基准的情况下，可以使用回报的协方差矩阵来计算前视跟踪误差。具体来说，跟 踪误差是投资组合回报率$w^Tr$和基准回报率$w_b^T\hat{r}$之差的标准差。这里，$w$是投资组合权重的 向量,$w_b$是基准权重的向量。向量$(w^Tr-w_b^T\hat{r})$是风险敞口的向量:

$${\begin{aligned}
TE&=\sqrt{Var(w^Tr-w_b^T\hat{r})}  \\
&=\sqrt{(w-w_b)^T\Sigma(w-w_b)}
\end{aligned}}$$

其中$\Sigma   $是证券回报的协方差矩阵。

\subsubsection{基于多因子模型的跟踪误差计算}

正如第九章解释的，一般的因子模型具有如下的形式：

$${\displaystyle r_{i}=\alpha _{i}+f _{1}\beta_{i1}+\cdots +f _{p}\beta_{ip}+\varepsilon _{i} \qquad i=1,\ldots ,n,}$$

$r_i$:第i份资产收益率

$f_k$：影响因子

$\beta_{ik}$:回归系数（灵敏度）

$\alpha$:常数

$\varepsilon _{i} $随机扰动

假设投资组合中有N个证券和K个因子，那么投资组合的方差 $\sigma_p^2$可以表示成为：

$$\sigma_p^2=\sum_{k=1}^K\sum_{l=1}^K\beta_{pk}\beta{pl}\sigma_{kl}^2+\sum_{i=1}^N\sigma_{\varepsilon _{i}}^2w_i^2$$

$\sigma_{\varepsilon _{i}}^2$:$\varepsilon _{i}$的方差；

$\sigma_{kl}^2$:因子k和因子l的协方差；

$\beta_{pk}$为对因子k的投资组合的敏感度：
$$\beta_{pk}=\sum_{i=1}^N\beta_{ik}w_i$$

基于多因子模型的跟踪误差为：
$$\sigma_{TE}=\sqrt{\sum_{k=1}^M\sum_{l=1}^M\overline{\beta_{pk}}~\overline{\beta_{pl}}\sigma_{kl}^2+\sum_{i=1}^N\sigma_{\varepsilon _{i}}^2(w_i-w_{ib})^2}$$

$\overline{\beta_{pk}}$为对因子k的投资组合的主动敏感度：
$$\overline{\beta_{pk}}=\sum_{i=1}^N\beta_{ik}w_i-\sum_{j=1}^{N_b}\beta_{jk}w_{jp}$$

在上述公式中 $N_b$是基准中证券的数量，$w_{ib}$是基准中证券i的权重。

\subsection{基准和指数}

\subsubsection{市场指数}

市场指数可以分为三类：

（1）那些来自交易所的，基于所有在交易所交易的证券。

（2）那些来自组织机构，其主观选择纳入基准的证券。

（3）那些证券选择来自客观测算，如市值，或对于债券来说，最低信用评级和发行规模。

市场指数中的证券必须以一定比例进行综合，并且必须对每种证券赋予权重。两种主要的加权机制的方法是：

(1)	市值加权。

(2)	均等加权。

\subsubsection{非市值加权指数}

历史上，市值加权的市场指数已成为客户选择的基准,在市场指数中使用市值加权的理 论依据是由资本市场理论提供的。如果市场是价格有效的且满足CAPM的限制性条件，那 么取得市场效率的最好方法是持有市值加权的投资组合，这也是指数意图体现的。然而，近 年来，在给定客户期望的风险敞口下，研究已经开始质疑市值市场指数是否提供了最高的期 望回报，进而这些指标是否是评估投资组合经理的合适基准。


我们基于AmQtt、Hsu和Moore的以个例子来说明如何构造一个特定指数。假 设我们想编制一个代表公司规模的基于基本面的指数，使用以下公司规模指标：

$\bullet$账面价值

$\bullet$5年尾随平均现金流

$\bullet$5年尾随平均收入

$\bullet$5年尾随平均销售总额

$\bullet$5年尾随平均总股息

$\bullet$总员工数

在根据每个指标对公司排名之后，可以计算排名中每个股票的相对权重，例如，根据每个 指标选择最大的1 000支股票。最后的结果可能是一个复合基本面指数，其中，股票的排名由 其在每个指标的规模因子相对权重的均等加权之和来确定。

\subsection{聪明的贝塔投资者}

我们已经在多个章节遇到了术语贝塔。贝塔衡量的是特定证券对市场的敏感性,例如，一个贝塔为1的股票与市场同步运行当市场回报率增加$1\%$时，贝塔为1的股票的回报率将增加$1\%$(平均）。

聪明贝塔这个术语现在是一个涵盖广泛策略的伞形术语。聪明贝塔机会集合可以包括(Thomas, 2014):

$\bullet$资本量加权的替代方法(如基于估值、低波动性或等权投资组合)。

$\bullet$对非传统资产类别(例如商品、无通胀、波动性、货币利率)的投资。

$\bullet$另类资产类别收益，如利率上下限和杠杆策略。


对于包括在单纯指数中的证券，可以有多种多样化的替代：

(1)	具有规范约束的最小波动性加权:在投资组合集中度的约束设置下，整体投资组合 波动性(标准差)最小化，此约束也称为规范约束。

(2)	有效最大夏普比率加权:投资组合夏普比率最大化，其中期望回报通过假设它们与股票所属的风险组中的下行风险中值成比例。

(3)	最大去相关加权:在假设股票之间个体波动相词之下，整体投资组合的波动是最小的。这个思路是组合股票以便利用投资组合中股票之间的低相关性而引起的风险削减效应， 而不是通过集中具有低波动性（标准差)的股票来降低风险。

这些多元化机制中的每一个都在牛市和熊市以及高波动和低波动状况中表现不同。

聪明贝塔基金十直在运用越来越复杂的投资规则。例如ProShares Large Cap Core Plus使用杠杆(即借人资金)针对10种不同因包括价值、成长，价格动量来购买股票。杠杆为什么可能有帮助的原因如下图所示。假设将因子模型用于创建一个具有最佳风险回报平衡的多元化股票投资组合(投资组合A)想要更高回报的投资者通常有两种选择: (1)投资更多的股票，承担更多的股票风险(投资组合C)，或(2)对一个多元化的投资组合应 用杠杆来实现特定的目标回报水平(投资组合B)。 ―个运用杠杆的投资继合一投资组合 B――是实现目标回报的选择之一。

\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{10.png}
\end{figure}

\section{量化权益投资组合管理的近期发展}
\subsection{实践中常用的投资组合约束}

\subsubsection{只多头约束}

许多基金和机构投资者在他们可以做空的金额上面临约束或被完全禁止。当不允许做
空时，投资组合配置优化模型就有$w \geq 0$的约束。

\subsubsection{持有约束}

多样性原则认为不应将投资组合的大部分投资于单一资产，或者在某一特定行业、板块
或国家具有高度资产集中度。对一个特定股票的持有约束可以用如下约束来设置：
$$I\leq w \leq u$$
其中，$I$和$u$分别是投资组合中每个股票持有的下限和上限向量。

考虑一个具有10支股票的投资组合，假设公司1、3、5的股票属于同一行业，且我们看
望约束该投资组合对此行业的散口至少为20$\%$，但最多为40$\%$。为了约束对该行业的口
我们对投资组合配置优化问题增加了约束:

$$0.2\leq w_1+w_2+w_3 \leq 0.4$$

\subsubsection{换手约束}

高投资组合换手可以导致高交易成本，使得投资组合再平衡效率低、成本高。因此，一些
投资组合经理在交易其投资组合时约束了可允许的换手额度。（另一种控制交易成本的方法
是明确地最小化交易成本；我们将在本章后面讨论合适的规划。）
换手约束通常对每一支股票都会设置：
$$|w_i-w_{0,i}|\leq u_i$$
也就是说，约束投资组合中股票$i$在期末、期初的权重之差的绝对值要小于特定上界。

\subsubsection{因子约束}

假设股票回报的因子结构有K个因子，也就是说，可通过下式来表达：
$$r_{i}=\alpha _{i}+f _{1}\beta_{i1}+\cdots +f _{K}\beta_{iK}+\varepsilon _{i} $$
下式约束了一个由N支股票所构成的投资组合对第k个风险因子的敞口：
$$\sum_{i=1}^{N}\beta_{ik}w_{i}\leq U_{k}$$

为了理解这个约束，注意基于个股收益的因子模型，投资组合的总收益可以写为
$$\sum_{i=1}^{N}r_i w_{i} =\sum_{i=1}^{N}w_{i}\alpha_i+ \sum_{i=1}^{N}(w_i(\sum_{k=1}^{K}\beta_{ik}f_k))+\sum_{i=1}^{N}w_i\varepsilon _{i} $$
投资组合对于不同因子的敏感度通过第二项来表达，其也可以写作:
$$\sum_{k=1}^{K}(\sum_{i=1}^{N}\beta_{ik}w_i)f_k$$
因此，对于特定因子k的敞口是f前的系数，即
$$\sum_{i=1}^{N}\beta_{ik}w_i$$

直观上，因子k在投资组合中的存在度通过对个股敞口的表现越大，投资组合对因子k
的敏感度将越大。因此，当计算投资组合对于因子k的总敞口时，既需要考虑该因子对于决
定投资组合中各股收益的重要性，也要考虑各股在投资组合中的所占比重。
实践中所使用的最大因子敞口约束的一个版本通常为:
$$\sum_{i=1}^{N}\beta_{ik}w_i=0$$
\subsubsection{基数约束}

我们对投资组合中N支股票的每一个引入一个二元变量。让我们将这些
二元变量表示为$\delta_1,\ldots,\delta_N$。如果投资组合包含股票$i$则变量$\delta_i$等于1，否则等于0。

假设从投资范围的N支股票中，我们希望最终的投资组合最多包含K个股票。此处，K
是一个小于N的正整数。这一约束可以规划为：
$$\sum_{i=1}^{N}\delta_i\leq K$$

\subsubsection{最小持有与交易规模的约束}

将在投资组合中持有的股票的金额临界值约束可以通过以下约束来设置：
$$|w_i|\geq L_i\delta_i$$
其中$L_i$，是股票$i$所允许的最小持有规模$\delta_i$是一个二元变量,如果股票被包含在投资组合中，则变量等于1，否则等于0。

\subsubsection{整批约束}

为了体现股票应该整批交易的条件，我们需要引人额外的决策变量（让我们将之称为
N）它们是整数并将对应于所购买的特定股票的单位数。每一个$z_i$都通过下式
与相对应的投资组合权重$w_i$相联系：
$$w_i=z_if_i,i=1,\ldots,N$$
其中，$f_i$以美元计量，并与将投资的总金额成比例。例如，假设总投资金额为1亿美元，股票
i以100股为交易单位，交易价格为50美元。那么:
$$f_i=\frac{50\cdot100}{100000000}=5\cdot 10^{-7}$$

施加整批约束的一个问题是投资组合中股票的总权重之和应该为100％,其实际上就是:
$$\sum_{i=1}^Nz_if_i=1$$
可能不会完全被满足。这是因为我们将特定的数块相加，不存在它们的组合相加后完全等于1.

解决这一个问题的一个可能就是放宽权重的约束：
$$\sum_{i=1}^Nz_if_i\leq1$$

\subsubsection{跟踪误差约束}

在第10章中，我们介绍了相对于基准的跟踪误差的概念。对投资组合跟踪误差的限制
通常被施加为一个约束。跟踪误差约束采用的形式如下：
$$(w-w_b)^{T}\Sigma(w-w_b)\leq \sigma^2$$
其中$\sigma^2$是投资者愿意承受的偏离基准的方差数量的界限（由投资者施加）。这是一个二次约
束，是凸函数且在计算上易处理，但需要专业的优化软件。

\subsubsection{软约束}

传统的优化规划将约束处理为硬约束；换言之，它们要求被满足。一些供应商的软件（如
彭博）允许投资组合经理指定软约束；即，如果能满足将是“美好的”，但在给定的特定惩罚下可能被违背的约束。

\subsubsection{约束带来的失调}

资组合优化依赖三个关键组成：（1）期望回报模型，（2）因子模型，以及（3）约束。这些
组成部分通常由投资组合管理团队中的不同组分别决定。当将它们一起应用于一个共同的
投资组合优化框架时，就可能发生失调问题。

\subsection{尾部风险度量的投资组合优化}
\subsubsection{投资组合在险价值优化}

资组合VaR最小化问题可以描述为一个带有机会约束的随机问题．其优化规划为：

$$
{\begin{aligned}
\min_{\gamma,w}~~&\gamma\\
s.t.~~&P(-rw>\gamma)\leq \varepsilon\\
~~& w^T\mathbf{1}=1
\end{aligned}}$$

其中r是关于投资组合优化在时间范围内（不确定的）股票回报的N维向量，w是投资组合中股
票权重的N向量。

结合我们在第7.2.3部分中对机会约束下的优化问题的讨论，优化投资组合配置以便所
得到的VaR为所有可能分布中最小的不是易事。例如，假设个股回报向量的S组可能场景
为$r^1,\ldots,r^S$VaR优化问题可以写作:

$$
{\begin{aligned}
\min_{\gamma,w}~~&\gamma\\
s.t.~~&-(r^s) w \leq b +My_s ~ s= 1,\ldots,S \\
&\sum_{s=1}^{S}y_s \leq [\varepsilon S] \\
& w^T\mathbf{1}=1\\
& y_s \in{0,1},s= 1,\ldots,S
\end{aligned}}$$

其中$[\varepsilon \cdot S]$表示S的整数部分，M是一个“大的”常数。

注意，对于包含1000组场景的数据集合，这个问题规划涉及对具有1000二元变量的
混合整数程序的求解，这需要花费大量时间。在实际中，VaR优化可以通过近似法或额外
的假设来完成。例如，如果我们假设股票回报服从一个多元正态分布，其均值向量为$\mu$协方
差矩阵为$\Sigma$，那么投资组合的VaR优化问题可以写为:

$$
{\begin{aligned}
\min_{\gamma,w}~~&\gamma\\
s.t.~~&-u^s w  +q_(1-\varepsilon)\sqrt{w^T\Sigma w}\leq \gamma \\
& w^T\mathbf{1}=1
\end{aligned}}$$
其中，$q_(1-\varepsilon)$是一个标准正态分布的第$100(1-\varepsilon)$个百分位。

\subsubsection{投资组合条件在险价值优化}

条件在险价值（CVaR）度量了以最大$\varepsilon$的概率发生的投资组合的平均损失，即在投资组合
回报概率分布尾部的平均损失。一个具有N支股票的投资组合的CVaR是投资组合中不同
股票不确定性回报（$N$维向量$r$）和投资组合中这些股票权重$w$的函数。对于任意给定的权
重集合$w$，投资组合回报等于$r_p=r^Tw$假设投资组合的回报$r_p$服从密度函数为$f$的概率
分布。那么，我们可以在数学上将$100(1-\varepsilon)$的CVaR写作:

$$CVaR_{1-\varepsilon}=\frac{1}{\varepsilon}\int_{-r\geq VaR_{(1-\varepsilon)}}(-r)f(r)dr$$

积分号内的项是在分布尾部的投资组合损失的期望值（占投资金额的百分比）。
以VaR为依据的CVaR的定义使得优化CVaR困难，因为我们首先要计算出VaR，如在
第11.2部分中所提到的，VaR本身就难以计算。 Rockafellar和 Uryasev（2000）提出使用具
有更佳计算属性的轴助目标函数代替CVaR。也就是，考虑下式：

$$F_{1-\varepsilon}(w,\xi)=\xi+\frac{1}{\varepsilon}\int_{-r\geq \xi}(-r-\xi)f(r)dr$$

他可以写成：

$$F_{1-\varepsilon}(w,\xi)=\xi+\frac{1}{\varepsilon}\int_{-\infty}^{\infty}\max\{-r-\xi,0\}f(r)dr$$


在一种特例下，即当投资组合中股票收益的联合概率密度函数体现在一组场景中时，
CVaR的最小化是一个非常容易处理的优化问题。这是我们在实际中所具有的典型类型的
数据我们可以使用历史数据或通过模拟产生场景。假设场景组中的每一个场景具有同样的
概率，那么函数可以写作：

$$F_{1-\varepsilon}(w,\xi)=\xi+\frac{1}{\varepsilon S}\sum_{s=1}^{S}\max\{-(r^s)^Tw-\xi,0\}f(r)dr$$

为了使这个函数更容易优化求解，我们通过引人额外Q策变量$y_1,\ldots,y_s$,投资组合的最小化同题可以写为：
$$
{\begin{aligned}
\min_{\gamma,w}~~&\xi+\frac{1}{[\varepsilon S]} \sum_{s=1}^{S}y_s\\
s.t.~~&y_s\geq -(r^s)^T w -\xi~ s= 1,\ldots,S \\
& w^T\mathbf{1}=1\\
 & y_s \leq 0~ s= 1,\ldots,S\\
\end{aligned}}$$

在一些情况下将投资组合的CVaR作为约束的一部分可能更可取。下面的优化规划通
过将上述问题改写为下式，在对投资组合CVaR约束下，将投资组合的期望回报最大化:

$$
{\begin{aligned}
\min_{\gamma,w}~~&\mu^Tw\\
s.t.~~&y_s\geq -(r^s)^T w -\xi~ s= 1,\ldots,S \\
&\xi+\frac{1}{[\varepsilon S]} \sum_{s=1}^{S}y_s\leq b_{1-\varepsilon}\\
& w^T\mathbf{1}=1\\
 & y_s \leq 0~ s= 1,\ldots,S\\
\end{aligned}}$$

\subsection{涵盖交易成本}
\subsubsection{线性交易成本}

让我们从简单的开始。假设交易成本是成比例的，即它们占交易规模$|t_i|=|w_i-w_{0,i}|$的百分比为 $c_i$那么，具有交易成本的投资组合可以写成：

$$\max w^T\mu-\lambda w^T\Sigma w-\lambda_{TC}\sum_{i=1}^Nc_i|w_i-w_{0,i}|$$

通过将绝对值项替换为新的决策变量y并加入两组约束，问题求解可以变得更为容易
因此，我们将目标函数重新写为：

$$\max w^T\mu-\lambda w^T\Sigma w-\lambda_{TC}\sum_{i=1}^Nc_iy_i$$

加入约束：
$$
{\begin{aligned}
y_i &\geq w_i-w_{0,i}\\
y_i &\geq -(w_i-w_{0,i})
\end{aligned}}$$

\subsubsection{分段线性交易成本}

将上部分中的模型再推进一步，我们可以在交易成本函数模型中引入分段线性近
似。这类函数比线性成本函数更通真，特别是对大规模交易。随着交易规模的增加，因为交
易的市场影响，它变得越来越昂贵。
下图展示了交易规模为t的一支特定股票交易成本的分段线性函数案例。图中的交
易成本函数假设了交易成本的增长率（反映为函数的斜率）在特定临界点将发生改变。例如
交易成本在日交易的$0-15\%$范围间低于在日交易量的$15\%40\%$范围间（或者其他的交易
这里我们将视为投资组合权重，但实际上将交易成本视作交易金额的百分比可能更为直观。通过简单地将乘以投资组合的总金额，投资组合权重和投资组合金额之间的来回转换是容易的。

\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{111.png}
\end{figure}

\subsubsection{二次交易成本}

通常将交易成本参数化为二次函数的形式：
$$TC(t) = c_i|t|+d_i |t|^2$$
系数$c$和$d$是从数据中测定的――比如，在正态条件下用一个二次函数来拟合观测到的特
定股票交易所产生的交易成本模式。
将这个函数包含于投资组合优化问题的目标函数中产生了一个二次程序，其可以用广泛
使用的二次优化软件来求解。

\subsubsection{固定交易成本}

固定交易成本的产生不受交易规模的影响。为了将这类成本加入投资组合优化问题，我
们需要对投资组合中N支股票的每一支引入相对应的二元变量$\delta_1,\ldots,\delta_N$,其中如果股票i
的交易量等于0，$\delta_i$等于0，否则等于1。这个思路与我们在第11.5部分对投资组合中仅能
拥有给定数量的股票的要求来建模是类似的。
假设股票i的固定交易成本是a。那么，交易成本函数为:
$$TC_i = a_i \delta_i$$

目标函数规划为:
$$\max w^T\mu-\lambda w^T\Sigma w-\lambda_{TC}\sum_{i=1}^N pa_i \delta_i$$

为了保证二元变量与交易金额$|w_i-w_{0,i}|$相关，我们需要添加以下的约束:
$$|w_i-w_{0,i}| \leq M\cdot\delta_i,i=1,\ldots,N$$

不同的交易成本模型可以结合使用。例如，如果交易既涉及固定成本也涉及可涞亩次
交易成本，那么我们可以采用如下这类交易成本函数:
$$TC_i = a_i \delta_i+c_i|t|+d_i|t|^2$$

\subsubsection{市场影响成本}
市场影响成本来自交易本身。当证券被买人时其价格通常会被抬高，而被卖出时价格则
会被压低。当交易规模与平均交易量的比率较高时，市场影响可能会是巨大的
学术文献和投资组合软件供应商发表的文章中都已经提到过各种市场影响成本模型。
模型通常会从如下这类幂律函数开始:

$$g(t)=\pm \gamma |t|^a$$

其中，$g(t)$是期望价格变动，系数$\gamma$和指数$a$的数值将通过对数据进行线性和非
线性回归来确定。选择符号以使得$g(t)$与和交易量$t$的符号相同。
例如， Almgre（2005）将影响拆分为永久性的和暂时性的，并
估计了如下交易成本函数:
$$TC_i = a_i |x_i|^{\frac{8}{5}}+b_ix_i^2$$
其中$x_i$是交易的股数。
将投资组合中的全部证券相加，在给定股票$1,\ldots,N$的交易股数$x_1,\ldots,x_N$下，并将总
成本的表达式纳人投资组合优化规划，就可以获得市场影响的总成本。

\subsection{多账户优化}

Chinned、 Scherer和Xu
（2006）描述了这样一个模型，并展现其能实现前文所述的公平的均衡。假设客户k的效用
函数是a，并具有对风险的惩罚，用金额收益表述。假设交易成本模型x给出交易成本的金
额，且x是一个递增的凸函数。其准确形式将取决于交易实施的细节。设t为交易的向量。
它通常的形式为$(t_1^+,\ldots,t_N^+,t_1^-)$也就是说，它将指定每一支股票i＝1，…，N的
累计买入$t_1^+$和累计卖出$t_1^-$但它也可能包含了关于交易是如何进行的信息。
多账户优化问题可以规划为:

$$
{\begin{aligned}
\max ~~&E(u_1(w_1))+\cdots+ E(u_K(w_K))-\tau(t)\\
s.t.~~& w_k \in C_k k=1,\cdots,K
\end{aligned}}$$
其中w是顾客k的股票持有量（或权重）的N维向量，$C_i$是客户k的投资组合结构约束的集
合。目标函数可以解释为净期望效用的最大化，即风险和净交易成本的惩罚后，期望金额收益最大化。

\subsection{涵盖税负}
在美国，当投资组合中的股票升值或贬值时，就会累积资本利得（对应地，责本损失），当
股票被卖出时，投资者对所实现的净资本利得缴纳税负。税金按照股票当前市价及其税基之
差的比例而计算得到，其中税基是股票最初买入时的价格。长期资本利得（当股票持有期超
过一年）的征税比例要低于短期资本利得（当股票持有期在一年之内）。由于同一支股票可能
在不同时点（以不同整批份额）被买入，因此卖出某一批股票而非其他批可能会得出不同的纳
税金额。除了资本利得税负之外，对没有被免税的投资者还需要缴纳其投资组合中股息的税
款。历史上，股息的税率都要高于资本利得，在当前是按照普通收入计税的，即投资者个人的
税率水平。因此，一个特定投资组合的纳税义务取决于交易执行的时间、投资组合的税基、累
积的短期及长期资本利得和投资者的纳税等级。

在美国，超过三分之二的投资组合资产由个人、保险公司和其他按收益纳税的公司所持
有。（也存在例外，如养老基金，其不需每年纳税。）研究已经表明，税负是投资者面对的最大
的费用支出一高于佣金和投资管理费。为了更直观地理解税负在投资者终身收入上的影
响，考虑一个每年资本增值为$6\%$的投资组合。30年后，投资于该投资组合的100美元将转
化为$1000(1+0.06)^{30}=5743．49$美元。现在假设将每年的资本利得变现，资本利得需缴纳
$20\%$的税金，且余下的资本利得再投资。30年后投资于投资组合的100美元将变成$1000
(1+(1-0．20)0.06)^{30}=4081．68$美元，比没有税费的金额要少约$30\%$，即使税率仅为资本
利得的五分之一。

随着投资者越来越注意税负对其收益的显著彩响，投资组合经理面临着越来越大的压力
后情况下变得非常不同。
需要将对税负的考虑纳入其投资组合再平衡决策，并汇报税后表现。因此，近年来，对将税负
纳入投资组合配置决策中的高效计算和严谨量化方法的需求日益增长。然而，从理论和实践
观点上，纳入税负问题的复杂性都是非常高的：
（1）税负义务的存在改变了对甚至是基本面投资组合表现的度量，如市值和风险。因
此，基于税前的评估投资组合表现的成熟方法并不适用于已意识到税负的投资组合的优化。
例如，在传统投资组合管理中，损失与风险相伴，因此应当尽可能被最小化。然而，在税负存
在时，损失的危害可能会减小，因为它们可以用于抵消资本利得并减少投资组合再平衡策略
的税负负担。在税负存在时，基准管理法也变得不那么明显：如果资产的税基不同，则两个具
有完全相同资产的投资组合是不等价的。
（2）税负考虑过于复杂以致无法用一种非自动的方式来实施：与此同时，将其自动纳入
投资组合再平衡算法需要有能力解决非常国难的、大规模的优化问题。
（3）对于具有税负考虑的投资组合管理的最佳方法是，在做出新投资组合权重推荐之前
观测几个阶段（如直到年底）收益预测的优化问题规划。然而，这种对投资组合优化问题的多
期观察在计算上是非常难以解决的一优化问题的维度，即变量和约束数量会随着所考虑时
间段的增加而呈指数增长。

\subsection{稳健的参数估计}

当依赖于历史数据进行估计的时候，我们假设过去为未来提供了一个好的代表。然而，期望回报显示出显著的时间变化（被称为非稳定性）。它们受到市场和经济条件（如利
率、政治环境、消费者信心及不同行业领域和地域的经济周期）变化的影响。因此，外推的历
史收益通常不是未来收益的好的预测。

类似地，协方差矩阵在时间上是不稳定的。此外，上千支股票协方差的样本估计也是众
所周知地不可靠，因为估计它们需要大型数据集，而相关数据如此大的数据集是难以获取的。
在实践中，投资组合经理基于他们对未来趋势的期望和预测模型，通常会主观或客观地
改变不同参数的历史估计。他们也会采用统计方法来寻找对异常值和其他抽样误差不太敏
感的估计量，例如贝叶斯和收缩估计量。

收缩是一种平均不同统计量的形式。收缩估计量通常包含三个组成部分：（1）具有很少
或没有结构的估计量（如样本均值）：（2）具有很多结构的估计量（收缩目标）；（3）反映收缩强
度的系数。金融文献中期望回报最著名的统计量可能是由 Jorion（1986）提出的。 Jorion 模型
中的收缩目标是最小方差投资组合收益的向量数组，收缩强度是从特定公式中确定的
收缩估计量也用于估计收益的协方差矩阵，尽管协方差矩阵估计量的等权重投资组合已经
显示与收缩估计量同样有效。

贝叶斯估计方法基于对特定事件将发生概率的主观解释。概率分布，称为先验分布，用
于代表投资者在任何数据被观测到之前对于概率的了解。在收集更多的信息后（例如，数据
被观测到），一个称作贝叶斯规则（以英国数学家托马斯贝叶斯来命名）的公式被用来计算
新的概率分布，称为后验分布。

\subsection{投资组合再抽样}

假设有N支备选股票的投资组合，其股票期望回报的初始估计是$\mu$:
（1）从均值为$\mu$、协方差矩阵为$\Sigma$的多元正态分布中模拟N支回报的S组样本
（2）利用（1）中得到的S组样本来计算期望回报$u_1,\ldots,u_s $和协方差矩阵$\Sigma_1,\ldots,\Sigma_s $
向量的S组新估计。
（3）求解S组投资组合优化间题，对每一对估算的期望回报和协方差$(\mu_S,\Sigma_S)$都有一组
解，并保留向量数组w中N支股票的权重，s＝$1,\ldots,S $。（优化问题本身可以是任何标准
的均值一方差规划：在风险约束下使期望回报最大化，在期望回报约束下使风险最小化，或是
效用函数最大化。
（4）为了发现最终投资组合权重，我们对在S个权重中每一支股票的权重进行平均，该
S个权重来自该股票在S组优化问题中的每一组。也就是说：
$$w=\frac{1}{S}\sum_{s=1}^{S}w^{s}$$

例如，投资组合中股票i的最终权重等于：

$$w=\frac{1}{S}\sum_{s=1}^{S}w_i^{s}$$

再抽样有其缺点：

因为再抽样的投资组合是通过模拟过程计算的，其中投资组合优化问题需要在每一步
求解，因此这个方法在计算上是繁琐的，特别是对大的投资组合。再抽样的步骤数和对误差
在投资组合构成上影响的估计的精确度之间存在权衡关系。
由于在计算中是对最终投资组合权重取均值，因此很有可能所有股票最终都具有非零
权重。如果最终投资组合被采用，这对将发生的交易成本造成影响。一种可能性是采用约|
来限制换手和非零权重股票的数量。然而，如我们在第11.1节中所见，采用这种约束将使优
化问题变得更加复杂，且可能使得再抽样过程变慢。
因为取均值过程是在优化问题解决后发生的，最终的权重可能实际上并不满足优化规
划中的一些约束。通常来说，仅有凸（如线性）约束一定会被取均值的最终权重来满足。例
如，不一定满足换手约束。这是实践应用中再抽样方法的一个严重局限。

\subsection{稳健的投资组合优化}

让我们举一个关于稳健优化框架是如何可以被应用于投资组合优化情的具体案例
考虑第8.4.2部分中经典的均值一方差投资组合配置问题的效用函数规划：

$${\begin{aligned}
\max_w ~~~&w^T\mu - \lambda w^{T}\Sigma w\\
s.t. ~~~& w^T\mathbf{1}  =1
\end{aligned}}$$

假设我们有期望回报和协方差矩阵的向量估计$\hat{\mu},\hat{\Sigma}$。我们将考虑一组“接近”
$\hat{\mu}$的向量$\mu$，而不是估计μ本身。我们定义不确定性集合:

$$U_\delta(\hat{\mu}) = \{\mu||u_i-\hat{\mu_i}| \leq \delta_i ,i=1,\ldots,N\}$$
换言之，集合$U_\delta(\hat{\mu})$包括所有向量$\mu = (\mu_1,\dots,\mu_N)$其中每个元素$\mu$都在区间$[u_i-\delta_i,u_i+\delta_i]$之内。

我们可以引入一个新的决策变量$v$，并将目标函数的表达式设为一个约束：
$${\begin{aligned}
\max_w ~~~&v\\
s.t. ~~~& w^T\mathbf{1}  =1\\
&w^T\mu - \lambda w^{T}\Sigma w \geq v
\end{aligned}}$$

这是优化中的一个标准技巧：决策变量的值将被最大化，但它被上式中的表达式$w^T\mu - \lambda w^{T}\Sigma w$约束，使得优化法将试图令$w^T\mu - \lambda w^{T}\Sigma w$尽可能大（即令其最大化）。这个问题的
最优解没有改变，但现在我们可以计算出约束的稳健对等式：
$$w^T\mu - \lambda w^{T}\Sigma w \geq v$$

采用如我们在第7．3节中对一般类型的约束:
$$a^Tx\leq b$$

同样的方法。也就是，我们先求解类如下式的优化问题：
$$\max_{\mu\in U_\delta(\hat{\mu}) }\{w^T\mu - \lambda w^{T}\Sigma w\} \leq -v$$

这个问题等价于:
$$\max_{\mu\in U_\delta(\hat{\mu}) }\{w^T\mu\} \leq -\lambda w^{T}\Sigma w\ -v$$

井且，由于约束右边的表达式中没有$\mu$，我们可以将整个表达式当作一个（关于的$\mu$）常数
换句话说，我们有约束$a^Tx\leq b$其中 $a=\mu,x=w,b=-\lambda w^{T}\Sigma w\ -v$

在期望回报的不确定性集合箱下，均值一方差优化问题的稳健对等式为
$${\begin{aligned}
\max_w ~~~&w^T\mu - \delta^T |w| - \lambda w^{T}\Sigma w \\
s.t. ~~~& w^T\mathbf{1}  =1
\end{aligned}}$$

其中 $|w|$标示了权重向量w的绝对值。为了直观起见，注意到如果投资组合中股票i的权重
为负数，那么股票期望回报的最坏结果就是$\mu+\delta_i$。（我们可能的最大损失量）。如果投资组
合中股票的权重是正的，那么股票i期望回报的最坏结果是$\mu-\delta_i$，（我们可能的最小收益
量）目标函数中的数学表达式与直觉相符：它使得投资组合期
望回报的最坏情况最小化。在这个均值一方差规划的稳健版本中，那些平均回报估计不太精
确的股票（即具有一个更大的估计误差$\delta_i$）因此在目标函数中被惩罚，且通常将在最优投资组
合配置中有一个更小的权重。

这个优化问题和非稳健的均值一方差规划具有相同的计算复杂度一也就是说，它可以
表述为一个二次优化问题。这可以通过采用第11.1节中所用的技巧将权重的绝对值去掉而
实现。即，我们引进额外变量的N维向量$\phi$来代替绝对值$|w|$，并将优化问题写成等同的版本：
$${\begin{aligned}
\max_w ~~~&w^T\mu - \delta^T \phi - \lambda w^{T}\Sigma w \\
s.t. ~~~& w^T\mathbf{1}  =1\\
&\phi\geq w_i,\phi \geq -w_i,i=1,\ldots,N
\end{aligned}}$$

对于期望回报估计的椭圆形不确定性集，均值一方差投资组合优化问题的稳健对等式被
证明是下列优化问题规划：

$${\begin{aligned}
\max_w ~~~&w^T\mu - \delta \sqrt{w^{T}\Sigma_u w } - \lambda w^{T}\Sigma w \\
s.t. ~~~& w^T\mathbf{1}  =1
\end{aligned}}$$
其中$\Sigma_u$是期望回报向量的估计误差的协方差矩阵。这是一个二阶锥同题，它需要专业软件来求解，但是求解它的方法是非常有效的。

在实践中，几种估计的近似方法已经被发现有效。例如，已经观测到更简单的估计方
式，如采用包含了估计方差的对角矩阵（而不是完全的误差协方差矩阵），它们常常在稳健投
资组合优化中带来最多益处。此外，估计期望回报的标准方式，如贝叶斯统计和基于回归的
方法，可以在其自身估计生成过程中产生对估计误差协方差矩阵的估计

然而，稳健优化不是万能的。通过使用稳健的投资组合优化规划，投资者可能会为了防
范估计不准确的风险，而含弃他们最优的投资组合配置，在该配置中实际与预期是一致的。
因此，当估计误差没有什么影响或当典型场景发生时，采用该技术的投资者不应该期望优于
经典的投资组合优化。然而，在那些场景中，当他们的估计偏离实际实现值达到其在建模过
程中预先设定的数量，他们应该期望稳操胜券。

\section{基于因子的权益投资组合构建和业绩评估}
\subsection{实践中运用的权益因子}
\subsubsection{基本面因子}

本面因子描述了一个公司的财务状况，且常常是可以从财务报表中直接读出或者计算
出的财务比率。由于许多财务比率展示了公司的类似特性，它们是相关的，因此没有必要考虑所有财务比率。当投资经理们做出投资决策时，他们常常会考虑以
部分或者综合指数。

$\bullet$价值因子：可包括市值、市盈(price earning，PE)率、市净(price to-book，P/B)率
市销( price-to-sales，P/S)率、股息收益(dividend yield，D/P)率、市现(price to-cash flow
CF）率和市价对息税折旧销前利润)price to－ EBITDA，P/FBITDA)比率。例如，有观察
表明小盘般的表现长期来看胜过大盘股，一些研究宣称具有高股息收益率，低/B．P/s
Pcv和P/EBITDA比率的公司倾向优于拥有低股息收益率，高PB、Ps、PCV和
P/EBITDA比率的公司。

$\bullet$增长潜力或增长因子：可包括市盈率相对增长( price-toearnings- growth，PG)比
车，研发支出相对销售额比率、广告支出相对销售额比率以及资本支出相对销售比率举
来说：PEG可以和PE结合起来考虑，一个高PE比率本身可能表明票价值被高估了
但如果伴随着低PEG比率，则给定潜在的公司成长，高PE比率可能是合理的。

$\bullet$经营效率因子可以包括卖出商品成本相对平均库存比率［库存周转( Inventory
umT)率］、总资产周转( total asset turnover， TAT)率、股票周转( uity turnover
ET)率和固定资产周转( fixed asset turnover，FAT)率。举例来说，一家高1T率的公司表明
该公司的产品需求量极大

$\bullet$偿付能力因子可以包括负债权益( debt-to-equity．D/E)比率、利息偿付率( Interest cov．
erage ratio，ICR)、流动比率( current，CUR)、速动比( quick ratio，QR)和现金比率(cash
raio，CR)。例如，一个高D/E比率的公司通常意味更高的务风险。一个高CUR比率(流
动资产与流动负债比率)通常说明较好的流动性；然面，它应与T比辛结合起来考察，因为大
量库存(通常可使流动比率虚高)可能也意味着公司的产品销售不好
经营获利因子可以包括毛利润( gross profit margin，GPMD、运营利润率( operating
profit margin，OPM)、净利润率等等。

$\bullet$流动性因子，例如交易周转率展示了交易股票的容易程度。更高的流动性通常转换为更高的回报。

\subsubsection{宏观经济因子}

引起因子模型在业界广泛传播的资产定价理论，是基于资产回报中的宏观经济因子，例
法如通货膨胀、实际利率和计算为Baa评级债券与政府债券回报利差的风险溢价，其他可用来
评估资产回报的经济和市场因子包括国内生产总值（GDP）、消费者情绪指数、商业信心指数
资者情绪指数和广域市场指数，如标普500指数。

\subsubsection{技术因子}
技术因子是基于历史价格、交易量和买卖差价之上而构建的。可能最广泛使用的技术因
子是动量，例如，它可以被计量为过去一年中的股票回报。研究已经发现股票回报有正自我
相关性，但这个结论并不总是对个股和在短期内适用。投资组合经理们利用技术因子以便考
虑股价可能的短期影响。

\subsubsection{其他因子}
其他可考虑的因子包括分析师们的预测、公司财务政策(如股权回购和内部购买)以及
社会责任因子，如员工关系、环境或人权问题。

\subsection{股票筛选}

林奇( Peter Lynch)来命名的，它鉴定出那些相对于其当前市场估值创造强劲增长的公司。其
中所使用的两个主要标准是P/E比率小于工业平均值，以及PEG比率小于1.0。
股票筛选并非投资组合构建的最复杂方法，但它们是直观的，且是一个很好的起点。在
股票筛选中使用的更复杂的分析工具包括x分数排名和经济计量、优化工具，x分数排名聚
合了多个基于潜在因子模型之上的排名，这些因子模型被构建以鉴别投资组合风险和回报的
来源，优化工具被用来根据特定条件构建具有所期望特征的和“最优”表现的投资组合。
z分数的概念在第2.4节中已经简明地介绍过了。它计算了观测值偏离概率分布平均值
有多少标准差。在股票筛选中，针对特定指标，诸如P/E比率，一个公司的x分数显示了相对
于其他在此指标投资范围内的公司，该公司是绩优还是绩劣。例如，假设一家投资经理考虑
在3月份投资10家公司，2月份这10家公司的平均P/E比率为25，而其PE比率的标准差
为13。假设A公司的P/E比率为23。A公司的z分数为:

$$
\frac{\text{单个P/E比率}-\text{平均PE比率}}{
\text{PE比率的标准差}}=-0.15
$$

这意味着A公司的PE比率低于所考虑的10家公司平均PE比率0.15个标准差。因为低
PE比率显示了公司的实力，相比于正z分数的公司，人们可能更希望获有10家公司的样本
中具有负z分数的公司。

\subsection{投资组合的选择}

\subsubsection{特定的投资组合选择}

对于投资组合经理，其管理是相对于基准回报的，模拟基准回报的简单方法是选择基准
中最大的持有者并将其保留在投资组合中。例如，如果投资组合经理想要持有30个股票，那
么可以包括基准中30个最大权重的股票。此外，如果投资组合经理希望投资组合领向于他
所偏好的股票，投资组合经理可以，比如，根据30个股票的总z分数（或任何其他排名方法）
对30个股票进行排序以便包括在投资组合中，并使用数学方法来计算这30个股票在投资组
合中的权重，使得权重加总为1，但“好”z分数的股票权重更高。
请注意，这种选择会使得投资组合易受特定因子（即规模）的影响。它也不能很好地控制投资
组合对其他因子的敞口。下面描述的分层法试图在决定投资组合配置时明确地考虑多个因子。

\subsubsection{分层法}

让我们考虑下例
假设投资组合经理想要匹配基准的行业组成因子，假设基准中有10个行业板块代表：信息技术，非必需消费品、能源、医疗保健，电信服务工业、金融，消费必需品、公用事业和材料。被
动的投资经理从这10个行业的每一个行业中选择一些股票，使得其投资组合中在特定行业的
所有段票的相对权重与在基准中行业的相对权重相同，采用指数增强型策略的经理可以选择将
表资组合候斜到一个预期会有出色业绩的行业，并增加投资组合中该行业股票的相对百分比。
现在假设投资经理想考虑第二个因子，如P/E比率。每个行业内的股票“组”或“单元”具
有比如“小”(如低于平均)、“中等”(平均)和“大(高于平均)的P/E比率。一个简单的方法来
示组别是想象一个二维矩阵(表)，其中每一列是一个行业组，它的每一行代表一个P/E比
率类别(表12．1)。指数中的股票根据其特性被配置给组里，被动策略的投资经理在每个组
(表格的单元格)的股票中进行选择，并且确保来自组内的代表性股票的相对权重与该组所有
段票在基准中的相对权重相同。采取指数增强型策略的理可以通过从投资组合某些组中
直意选择高于或低于它们在基准中所表现的百分比来倾斜投资组合。

\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{121.png}
\end{figure}

\subsubsection{因子敞口定向}
因子散口定向使用来自因子模型的贝塔来控制投资组合对特定因子的散口。
例如，如果基准是因子之一，那么可以将关于基准的投资组合的贝塔设置为1，或者对投
资组合贝塔距离1的偏差设置约束：
$$0.9\leq \beta_p \leq 1.1$$

\subsection{风险分解}

投资组合构建和管理过程中的一个重要部分是理解投资组合中的风险来源。在实践中
该部分简化为估计不同因子的变动在何种程度上贡献了投资组合回报的变动。有时，投资组
合风险管理软件供应商将因子称为风险因子，以强调其在投资组合变动中的应用。将投资组
合风险的特定指标分解为因子贡献的过程称为投资组合风险分解。在本节中，我们提供了
个投资经理如何执行风险分解的示例，具体来说，我们考虑了美国大盘股投资组合，并关注
相对于基准(标普500指数)的主动风险的分解.

在该示例中，主动风险将被计算为投资组合回报与基准回报之差的方差，即跟踪误差的
平方。我们首先将投资组合的主动风险分解为三个来源的风险：特定的(可归因于单个证券
的变动)、风格的(归因于风格类别因子的变动，我们稍后将回顾)和行业的(归因于投资组合
中各行业业绩的变动)。下图中的百分比堆叠柱形图显示了特定、风格和行业因子在总主
动风险中所代表的百分比。可以观察到，股票特定风险是投资组合主动风险中最大的组成部
分，风格因子变动在过去的三个月中一直在增加(主动风险的该部分，即在每个日期对应于风
格风险的柱状比例一直在增加)。


\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{122.png}
\end{figure}

我们可以深入探究导致风格因子变动的具体因子，下图中的堆叠柱形图展示了在每
时点的主动投资组合风险(每个柱的总高度)和归因于风格因子的主动风险量，这些风格因
子包括如规模、短期动量，被动率、汇率敏感性、中期动量、市场敏感性、增长、杠杆、流动性和
价值(在每个日期柱状相应部分的长度)，规模和波动率(每个柱状顶部两个部分)是主动风
险的最大页献者
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{123.png}
\end{figure}

时间序列的展示，下图显示了投资组合是否在历史上对风格因子过度暴露或暴露
不足，其为投资组合主动风险的最大贡献者。在这个案例中，看来对波动率曾有过系统性的
做多(投资组合在过去一年半中一直保持较高的风险口)，及对规模的系统性做空(投资组
合对该因子一直为负晨冢并且在过去两个月中变得更为严重)。对于另一个风格因子价值
(图中间最浅的线)的暴露，总是稳定且较小。
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{124.png}
\end{figure}

让我们更深入地了解规模在投资组合主动风险中扮演的角色。根据行业和市值分解的
风险表(表12．2)所示，投资组合主动风险的大部分(51．30$\%$)是由小盘股(市值小于100亿美
元)贡献的。在所有板块中最大的风险贡献者是信息技术，为主动风险的18．79$\%$。
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{125.png}
\end{figure}

什么因子导致了信息技术板块的变动呢？下图显示了旋风图，每个行业板块的主动
权重和其所代表的主动风险的百分比(左图)，以及信息技术板块内每个行业的主动权重和其
所代表的主动风险的百分比(右图)。旋风图显示了规模及其符号，并按降序对类别进行了排
序。如果一个柱指向左边，那么它是负的。柱的长度对应于规模。在这个案例中，观察左侧
的旋风图，我们可以看到，信息技术板块不仅占主动投资组合风险的最大百分比，

并且也是最大的减持行业板块(纵轴负侧的第一个黑色)，观察右侧的旋
风图，信息技术板块内主动风险的最大贡献者是技术硬件存储和外圆设备，约占主动风险的
7$\%$(纵轴正侧的第一个灰色柱)，技术硬件存储和外围设备的主动权重约为一5$\%$(纵轴负侧
的第一个黑色柱)
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{126.png}
\end{figure}

技术硬件存储和外围设备中的哪些股票是最大的风险贡献者？下图中的风险分解可
视化使得我们能够深入探究个股层面。
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{127.png}
\end{figure}

进一步的可视化可以展示投资组合中每支股票的原始因子敞口。（回顾第10章，因子散
口是因子模型中的贝塔系数；它们反映了股票回报对因子水平变化的敏感性。）表12．3使用条
件格式来显示对风格因子（作为标题列在第一行）有较大的正风险散口和较大负风险散口的
股票（作为标题列在第一列）。这在几个方面是有用的。首先，我们可以在众多指标中识别投
资组合中每个股票的基本属性。例如，苹果公司是（ Apple，Ine）大型的、流动性强的、增长型

的，并且具有负的短期动量。第二，这种可视化可以帮助我们找到股票来增加或减少我们对
持定因子的放口。例如，投资组合一直对规模的权重不足。如果想增加对这个因子
的放口，那么我们可以关注对规模有高度敞口的股票：在这个例子中，它们是美学石油
Exxon Mobil Corporation)、沃尔玛( Wal Mart Stores，Ine)和微软( Microsoft Corporation)。
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{128.png}
\end{figure}
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{129.png}
\end{figure}

\subsection{压力测试}
压力测试是稳健的投资组合风险管理策略的另一个重要组成部分。它涉及对投资组合
进行情景假设，以了解当这种情景发生时，投资组合将如何表现。因子模型也广泛地用于这
种情况。

下图展示了可进行的分析、其中上图显示了来自第12．4节的投资组合在过去一年半时
间中的业绩，以感受投资组合回报所实现的通常价值．底部的图显示了10种压力情景，例如长
期资本管理公司在198年8月的“死亡“(标为＂LTCM8/1998)、2008年10月的信用危机（标
为“信用危机＂，以及标普500指数下跌30$\%$(标为“标普500-30$\%$＂。因为投资组
合中小盘股股票权重超额，所以我们测试了当大盘股业绩优于小盘股时会发生什么．投资组合
也在波动率上超额，国此我们测试了当波动率上升时将会发生的情况(情景“波动率上升”。我
们可以看到，其中的一些情况并不产生投资组合回报，它们与近期的回报明显不同。例如，增加
波动率导致主动走姿组合的回报率为1.18$\%$投资组合最大下跌风险敞口是当大盘股
优于小盘股时(-3.97$\%$)其次是当标普50指数下跌30$\%$时候。
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{1210.png}
\end{figure}

\subsection{投资组合业绩评估}
投资组合的表现被定期跟踪和评估。我们考虑第12．4节案例中的投资组合来说明投资
组合经理如何从风险归因中提高业绩。
在这个例子中(见下图)，投资经理观察了一年半(从2011年6月到2012年12月)时间内的
总动回报(中灰线)。投资组合的主动回报在过去一年大幅下降。通过在同一图上绘制个
回(灰色线)和由因子解释的回报(最灰色线)，投资组合经理可以观察到，大多数业绩
不佳是由于错误的因子配置。(这是因为由因子解释的回报部分一直是负的。)另一方面，个
段的回报是可以接受的，这意味着投资组合经理在选择个股方面做得相当不错。投资组合经
理应该重新评估他的因子配置决策。
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{1211.png}
\end{figure}

让我们对因子配置问题进行更细致的分析。具体来说，让我们看看行业板块的投资决策。下图显示了各板块的风险归因。
\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{1212.png}
\end{figure}

哪些因子是导致这个业绩的原因？让我们对风格类别中的因子进行因子归因。
下图左边的旋风图显示，波动率是对累积投资组合回报负面贡献的最大因子。短期
动量、杠杆、规模和价值都有负面贡献，但程度较小。另一方面，中期动量和增长是累积投资
组合回报中的两个最大的积极贡献者。对增长的系统性做多似乎已经获得回报。
图12．10右让姘逯械谋硐允玖硕砸导ㄓ兴贡献的每个因子的权重决定。波动率因子在
投资组合中的权重超额(平均主动散口为0．15$\%$)，相对于基准，该因子平均具有负因子回报
(-0．99$\%$)、因此归因于该因子的累积负的主动投资组合回报为-3．05$\%$

\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{1213.png}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{1214.png}
\end{figure}

最后下图中的时间序列图能够比较在所考虑的一年半期间风格类别中所有因子的大
政市场业绩，从图中可以看出，波动率的表现一直差于(它总是更负)其他风格因子。短期动
量、流动性和杠杆也是负业绩，虽然程度较小。中期动量、增长型和价值一直实现了正业绩

\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{1215.png}
\end{figure}

\subsection{风险预测与模拟}
因子模型对于回报预测不如对于风险分解有用。然而，当试图对未来投资组合的业绩有
一个窥见时，它们仍然可能提供有意义的信息。投资组合经理需要意识到，短期因子模型只
能提供短期预测，而长期因子模型并不一定能很好地预测短期业绩。一般来说，因子模型预
测的可靠性随着人们对未来的延仲而急剧降低。
然而，因子比个股更可能表现出一致性的行为。了解那些导致投资组合变动的因子和它
们在历史上的表现，可以有助于模拟投资组合在未来将可能如何表现的有意义的场景。
未来投资组合风险和回报的预测通常通过蒙特卡洛模拟来进行。通过分解投资组合回
报的来源，构建模型来解释它们，并模拟各个因子的回报来计算总投资组合回报，管理者可以
获得未来投资组合回报的可能分布，这包括未来特定日期的回报值以及它们将发生的概率。
在此基础上，可以计算投资组合业绩的指标，例如在险价值(VaR)和条件风险价值(CVaR)。
结果通常看起来像下图中模拟的未来投资组合回报的直方图。基于直方图，对于第
12．4节中的案例，投资组合的20个交易日95$\%$VaR为7．36$\%$(在图上标为95$\%$)。这可解
释为：在95$\%$的概率下，20个交易日之后的投资组合损失最多为投资组合价值的7．36$\%$

\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{1216.png}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{1217.png}
\end{figure}


\end{CJK*}
\end{document}
