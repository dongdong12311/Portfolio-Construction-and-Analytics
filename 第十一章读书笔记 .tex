\documentclass[a4paper,12pt,twoside]{article}
\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4}
\usepackage{ccmap}
\usepackage{CJK}
\usepackage{times}
\usepackage{latexsym}
\usepackage{graphicx}

	\graphicspath{{figures/}}	%在tex目录下新建figures文件夹存放所有图片
\usepackage[left=2.5cm,right=2.5cm,top=2.5cm,bottom=2.5cm]{geometry}
\usepackage{mathrsfs}
\usepackage{bm,array}
\usepackage{subfigure}
\usepackage{indentfirst}
	\setlength{\parindent}{2em}
\usepackage{enumerate}
\usepackage{amsmath,amsthm,amssymb,amsfonts,extarrows}
\usepackage{cite}
\usepackage[labelsep=space]{caption}
\usepackage{float}
\usepackage{fancyhdr}		%设置页眉页脚
	\renewcommand{\headrulewidth}{0.5pt}
	\renewcommand{\sectionmark}[1]{\markboth{\xiaowuhao 第\,\thesection\,章\hspace*{1em}#1}{\xiaowuhao }}
\usepackage{pdfpages}
\usepackage{listings} %插入代码
\usepackage{xcolor} %代码高亮

\lstset{numbers=left, %设置行号位置
        numberstyle=\tiny, %设置行号大小
        keywordstyle=\color{blue}, %设置关键字颜色
        commentstyle=\color[cmyk]{1,0,1,0}, %设置注释颜色
        frame=single, %设置边框格式
        escapeinside=``, %逃逸字符(1左面的键)，用于显示中文
        breaklines, %自动折行
        extendedchars=false, %解决代码跨页时，章节标题，页眉等汉字不显示的问题
        xleftmargin=2em,xrightmargin=2em, aboveskip=1em, %设置边距
        tabsize=4, %设置tab空格数
        showspaces=false %不显示空格
       }
\usepackage{titlesec}	%设置章节标题格式
	\titleformat{\section}{\xiaosanhao\hei}{第\,\thesection\,章}{1em}{}
	\titleformat{\subsection}{\sihao\hei}{\thesubsection}{1em}{}
	\titleformat{\subsubsection}{\xiaosihao\hei}{\thesubsubsection}{0em}{}
	\titlespacing{\section}{0pt}{0pt}{1em}
	\titlespacing{\subsection}{0pt}{0pt}{0em}
	\titlespacing{\subsubsection}{0pt}{0pt}{0em}
\usepackage{titletoc}		%设置目录内容格式
	\titlecontents{section}[0em]{\sihao\hei}{第\,\thecontentslabel\,章\hspace*{1em}}{}{\dotfill\contentspage}[\addvspace{-3mm}]
	\titlecontents{subsection}[1em]{\xiaosihao\hei}{\,\,\thecontentslabel\hspace*{1em}}{}{\dotfill\contentspage}[\addvspace{-3mm}]
\renewcommand{\figurename}{\wuhao\bf 图}
\renewcommand{\thefigure}{\thesection-\arabic{figure}}
\renewcommand{\contentsname}{\xiaosanhao\hei \centerline{目录}}
\renewcommand{\refname}{\xiaosanhao\hei 参考文献}
%\newcommand{\upcite}[1]{\textsuperscript{\cite{#1}}}	%若想引用参考文献时使用上标数字可使用此句
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{Proposition}[theorem]{Proposition}
\newtheorem{Remark}[theorem]{Remark}
\newtheorem{remark}[theorem]{remark}
\newtheorem{Corollary}[theorem]{Corollary}
\numberwithin{equation}{section}	%公式编号跟随章节
\allowdisplaybreaks

\renewcommand{\baselinestretch}{1.5}	%1.5倍行距
\newcommand{\erhao}{\fontsize{21pt}{\baselineskip}\selectfont}		%设置字号
\newcommand{\sanhao}{\fontsize{16pt}{\baselineskip}\selectfont}
\newcommand{\xiaosanhao}{\fontsize{15pt}{\baselineskip}\selectfont}
\newcommand{\sihao}{\fontsize{14pt}{\baselineskip}\selectfont}
\newcommand{\xiaosihao}{\fontsize{12pt}{\baselineskip}\selectfont}
\newcommand{\wuhao}{\fontsize{10.5pt}{\baselineskip}\selectfont}
\newcommand{\xiaowuhao}{\fontsize{9pt}{\baselineskip}\selectfont}

\newcommand{\song}{\CJKfamily{song}}    %设置字体
\newcommand{\hei}{\CJKfamily{hei}}
\newcommand{\Arial}{\fontfamily{phv}\selectfont}



\begin{document}
\begin{CJK*}{GBK}{song}

\renewcommand{\sectionmark}[1]{\markboth{\xiaowuhao 第\,\thesection\,章\hspace*{1em}#1}{\xiaowuhao }}
%\titleformat{\section}{\xiaosanhao\hei}{第\,\thesection\,节}{1em}{}
%\titlecontents{section}[0em]{\sihao\hei}{第\,\thecontentslabel\,节\hspace*{1em}}{}{\dotfill\contentspage}[\addvspace{-3mm}]

%----------------------------------------------------------------------------------------
%	目录
%----------------------------------------------------------------------------------------

\newpage
\begin{center}
\begin{hei}
\Large
Portfolio Construction and Analytics 读书笔记\\
\end{hei}
\end{center}



\thispagestyle{fancy}
\fancyhf{}
%\chead{\xiaowuhao }
\cfoot{\xiaowuhao \thepage}
\tableofcontents
\addcontentsline{toc}{section}{目录}

%完成封面到附录后，最后制作英文目录
%将已完成的所有tex代码复制粘贴至Content.tex文件，将加入目录的部分改为对应的英文即可
\newpage
\addcontentsline{toc}{section}{\Arial Contents}

%完成封面到附录后，最后制作英文目录
%将已完成的所有tex代码复制粘贴至Content.tex文件，将加入目录的部分改为对应的英文即可
\newpage
\addcontentsline{toc}{section}{\Arial Contents}


%以下每一章(包括参考文献、附录)都要另起一页，并从奇数页开始
%可以自行加入如下两行代码添加空白页
%\newpage
%\quad

%----------------------------------------------------------------------------------------
%	第一章 引言
%----------------------------------------------------------------------------------------

\newpage
\pagestyle{fancy}
\fancyhead[CE]{\rightmark}
\fancyhead[CO]{\leftmark}
\fancyfoot[CE,CO]{\xiaowuhao \thepage}
\setcounter{page}{0}
\pagenumbering{arabic}
\section{资产管理的介绍}
\section{随机变量、概率分布和重要的统计概念}
\section{常见的分布函数介绍}
\section{统计学模型}
\section{模型模拟}
\section{模型优化}
\section{非确定优化}
\section{资产多样化}
\section{因子模型}
\section{投资组合构建的基准和跟踪误差的使用}
\section{量化权益投资组合管理的近期发展}
\subsection{实践中常用的投资组合约束}

\subsubsection{只多头约束}

许多基金和机构投资者在他们可以做空的金额上面临约束或被完全禁止。当不允许做
空时，投资组合配置优化模型就有$w \geq 0$的约束。

\subsubsection{持有约束}

多样性原则认为不应将投资组合的大部分投资于单一资产，或者在某一特定行业、板块
或国家具有高度资产集中度。对一个特定股票的持有约束可以用如下约束来设置：
$$I\leq w \leq u$$
其中，$I$和$u$分别是投资组合中每个股票持有的下限和上限向量。

考虑一个具有10支股票的投资组合，假设公司1、3、5的股票属于同一行业，且我们看
望约束该投资组合对此行业的散口至少为20$\%$，但最多为40$\%$。为了约束对该行业的口
我们对投资组合配置优化问题增加了约束:

$$0.2\leq w_1+w_2+w_3 \leq 0.4$$

\subsubsection{换手约束}

高投资组合换手可以导致高交易成本，使得投资组合再平衡效率低、成本高。因此，一些
投资组合经理在交易其投资组合时约束了可允许的换手额度。（另一种控制交易成本的方法
是明确地最小化交易成本；我们将在本章后面讨论合适的规划。）
换手约束通常对每一支股票都会设置：
$$|w_i-w_{0,i}|\leq u_i$$
也就是说，约束投资组合中股票$i$在期末、期初的权重之差的绝对值要小于特定上界。

\subsubsection{因子约束}

假设股票回报的因子结构有K个因子，也就是说，可通过下式来表达：
$$r_{i}=\alpha _{i}+f _{1}\beta_{i1}+\cdots +f _{K}\beta_{iK}+\varepsilon _{i} $$
下式约束了一个由N支股票所构成的投资组合对第k个风险因子的敞口：
$$\sum_{i=1}^{N}\beta_{ik}w_{i}\leq U_{k}$$

为了理解这个约束，注意基于个股收益的因子模型，投资组合的总收益可以写为
$$\sum_{i=1}^{N}r_i w_{i} =\sum_{i=1}^{N}w_{i}\alpha_i+ \sum_{i=1}^{N}(w_i(\sum_{k=1}^{K}\beta_{ik}f_k))+\sum_{i=1}^{N}w_i\varepsilon _{i} $$
投资组合对于不同因子的敏感度通过第二项来表达，其也可以写作:
$$\sum_{k=1}^{K}(\sum_{i=1}^{N}\beta_{ik}w_i)f_k$$
因此，对于特定因子k的敞口是f前的系数，即
$$\sum_{i=1}^{N}\beta_{ik}w_i$$

直观上，因子k在投资组合中的存在度通过对个股敞口的表现越大，投资组合对因子k
的敏感度将越大。因此，当计算投资组合对于因子k的总敞口时，既需要考虑该因子对于决
定投资组合中各股收益的重要性，也要考虑各股在投资组合中的所占比重。
实践中所使用的最大因子敞口约束的一个版本通常为:
$$\sum_{i=1}^{N}\beta_{ik}w_i=0$$
\subsubsection{基数约束}

我们对投资组合中N支股票的每一个引入一个二元变量。让我们将这些
二元变量表示为$\delta_1,\ldots,\delta_N$。如果投资组合包含股票$i$则变量$\delta_i$等于1，否则等于0。

假设从投资范围的N支股票中，我们希望最终的投资组合最多包含K个股票。此处，K
是一个小于N的正整数。这一约束可以规划为：
$$\sum_{i=1}^{N}\delta_i\leq K$$

\subsubsection{最小持有与交易规模的约束}

将在投资组合中持有的股票的金额临界值约束可以通过以下约束来设置：
$$|w_i|\geq L_i\delta_i$$
其中$L_i$，是股票$i$所允许的最小持有规模$\delta_i$是一个二元变量,如果股票被包含在投资组合中，则变量等于1，否则等于0。

\subsubsection{整批约束}

为了体现股票应该整批交易的条件，我们需要引人额外的决策变量（让我们将之称为
N）它们是整数并将对应于所购买的特定股票的单位数。每一个$z_i$都通过下式
与相对应的投资组合权重$w_i$相联系：
$$w_i=z_if_i,i=1,\ldots,N$$
其中，$f_i$以美元计量，并与将投资的总金额成比例。例如，假设总投资金额为1亿美元，股票
i以100股为交易单位，交易价格为50美元。那么:
$$f_i=\frac{50\cdot100}{100000000}=5\cdot 10^{-7}$$

施加整批约束的一个问题是投资组合中股票的总权重之和应该为100％,其实际上就是:
$$\sum_{i=1}^Nz_if_i=1$$
可能不会完全被满足。这是因为我们将特定的数块相加，不存在它们的组合相加后完全等于1.

解决这一个问题的一个可能就是放宽权重的约束：
$$\sum_{i=1}^Nz_if_i\leq1$$

\subsubsection{跟踪误差约束}

在第10章中，我们介绍了相对于基准的跟踪误差的概念。对投资组合跟踪误差的限制
通常被施加为一个约束。跟踪误差约束采用的形式如下：
$$(w-w_b)^{T}\Sigma(w-w_b)\leq \sigma^2$$
其中$\sigma^2$是投资者愿意承受的偏离基准的方差数量的界限（由投资者施加）。这是一个二次约
束，是凸函数且在计算上易处理，但需要专业的优化软件。

\subsubsection{软约束}

传统的优化规划将约束处理为硬约束；换言之，它们要求被满足。一些供应商的软件（如
彭博）允许投资组合经理指定软约束；即，如果能满足将是“美好的”，但在给定的特定惩罚下可能被违背的约束。

\subsubsection{约束带来的失调}

资组合优化依赖三个关键组成：（1）期望回报模型，（2）因子模型，以及（3）约束。这些
组成部分通常由投资组合管理团队中的不同组分别决定。当将它们一起应用于一个共同的
投资组合优化框架时，就可能发生失调问题。

\subsection{尾部风险度量的投资组合优化}
\subsubsection{投资组合在险价值优化}

资组合VaR最小化问题可以描述为一个带有机会约束的随机问题．其优化规划为：

$$
{\begin{aligned}
\min_{\gamma,w}~~&\gamma\\
s.t.~~&P(-rw>\gamma)\leq \varepsilon\\
~~& w^T\mathbf{1}=1
\end{aligned}}$$

其中r是关于投资组合优化在时间范围内（不确定的）股票回报的N维向量，w是投资组合中股
票权重的N向量。

结合我们在第7.2.3部分中对机会约束下的优化问题的讨论，优化投资组合配置以便所
得到的VaR为所有可能分布中最小的不是易事。例如，假设个股回报向量的S组可能场景
为$r^1,\ldots,r^S$VaR优化问题可以写作:

$$
{\begin{aligned}
\min_{\gamma,w}~~&\gamma\\
s.t.~~&-(r^s) w \leq b +My_s ~ s= 1,\ldots,S \\
&\sum_{s=1}^{S}y_s \leq [\varepsilon S] \\
& w^T\mathbf{1}=1\\
& y_s \in{0,1},s= 1,\ldots,S
\end{aligned}}$$

其中$[\varepsilon \cdot S]$表示S的整数部分，M是一个“大的”常数。

注意，对于包含1000组场景的数据集合，这个问题规划涉及对具有1000二元变量的
混合整数程序的求解，这需要花费大量时间。在实际中，VaR优化可以通过近似法或额外
的假设来完成。例如，如果我们假设股票回报服从一个多元正态分布，其均值向量为$\mu$协方
差矩阵为$\Sigma$，那么投资组合的VaR优化问题可以写为:

$$
{\begin{aligned}
\min_{\gamma,w}~~&\gamma\\
s.t.~~&-u^s w  +q_(1-\varepsilon)\sqrt{w^T\Sigma w}\leq \gamma \\
& w^T\mathbf{1}=1
\end{aligned}}$$
其中，$q_(1-\varepsilon)$是一个标准正态分布的第$100(1-\varepsilon)$个百分位。

\subsubsection{投资组合条件在险价值优化}

条件在险价值（CVaR）度量了以最大$\varepsilon$的概率发生的投资组合的平均损失，即在投资组合
回报概率分布尾部的平均损失。一个具有N支股票的投资组合的CVaR是投资组合中不同
股票不确定性回报（$N$维向量$r$）和投资组合中这些股票权重$w$的函数。对于任意给定的权
重集合$w$，投资组合回报等于$r_p=r^Tw$假设投资组合的回报$r_p$服从密度函数为$f$的概率
分布。那么，我们可以在数学上将$100(1-\varepsilon)$的CVaR写作:

$$CVaR_{1-\varepsilon}=\frac{1}{\varepsilon}\int_{-r\geq VaR_{(1-\varepsilon)}}(-r)f(r)dr$$

积分号内的项是在分布尾部的投资组合损失的期望值（占投资金额的百分比）。
以VaR为依据的CVaR的定义使得优化CVaR困难，因为我们首先要计算出VaR，如在
第11.2部分中所提到的，VaR本身就难以计算。 Rockafellar和 Uryasev（2000）提出使用具
有更佳计算属性的轴助目标函数代替CVaR。也就是，考虑下式：

$$F_{1-\varepsilon}(w,\xi)=\xi+\frac{1}{\varepsilon}\int_{-r\geq \xi}(-r-\xi)f(r)dr$$

他可以写成：

$$F_{1-\varepsilon}(w,\xi)=\xi+\frac{1}{\varepsilon}\int_{-\infty}^{\infty}\max\{-r-\xi,0\}f(r)dr$$


在一种特例下，即当投资组合中股票收益的联合概率密度函数体现在一组场景中时，
CVaR的最小化是一个非常容易处理的优化问题。这是我们在实际中所具有的典型类型的
数据我们可以使用历史数据或通过模拟产生场景。假设场景组中的每一个场景具有同样的
概率，那么函数可以写作：

$$F_{1-\varepsilon}(w,\xi)=\xi+\frac{1}{\varepsilon S}\sum_{s=1}^{S}\max\{-(r^s)^Tw-\xi,0\}f(r)dr$$

为了使这个函数更容易优化求解，我们通过引人额外Q策变量$y_1,\ldots,y_s$,投资组合的最小化同题可以写为：
$$
{\begin{aligned}
\min_{\gamma,w}~~&\xi+\frac{1}{[\varepsilon S]} \sum_{s=1}^{S}y_s\\
s.t.~~&y_s\geq -(r^s)^T w -\xi~ s= 1,\ldots,S \\
& w^T\mathbf{1}=1\\
 & y_s \leq 0~ s= 1,\ldots,S\\
\end{aligned}}$$

在一些情况下将投资组合的CVaR作为约束的一部分可能更可取。下面的优化规划通
过将上述问题改写为下式，在对投资组合CVaR约束下，将投资组合的期望回报最大化:

$$
{\begin{aligned}
\min_{\gamma,w}~~&\mu^Tw\\
s.t.~~&y_s\geq -(r^s)^T w -\xi~ s= 1,\ldots,S \\
&\xi+\frac{1}{[\varepsilon S]} \sum_{s=1}^{S}y_s\leq b_{1-\varepsilon}\\
& w^T\mathbf{1}=1\\
 & y_s \leq 0~ s= 1,\ldots,S\\
\end{aligned}}$$

\subsection{涵盖交易成本}
\subsubsection{线性交易成本}

让我们从简单的开始。假设交易成本是成比例的，即它们占交易规模$|t_i|=|w_i-w_{0,i}|$的百分比为 $c_i$那么，具有交易成本的投资组合可以写成：

$$\max w^T\mu-\lambda w^T\Sigma w-\lambda_{TC}\sum_{i=1}^Nc_i|w_i-w_{0,i}|$$

通过将绝对值项替换为新的决策变量y并加入两组约束，问题求解可以变得更为容易
因此，我们将目标函数重新写为：

$$\max w^T\mu-\lambda w^T\Sigma w-\lambda_{TC}\sum_{i=1}^Nc_iy_i$$

加入约束：
$$
{\begin{aligned}
y_i &\geq w_i-w_{0,i}\\
y_i &\geq -(w_i-w_{0,i})
\end{aligned}}$$

\subsubsection{分段线性交易成本}

将上部分中的模型再推进一步，我们可以在交易成本函数模型中引入分段线性近
似。这类函数比线性成本函数更通真，特别是对大规模交易。随着交易规模的增加，因为交
易的市场影响，它变得越来越昂贵。
下图展示了交易规模为t的一支特定股票交易成本的分段线性函数案例。图中的交
易成本函数假设了交易成本的增长率（反映为函数的斜率）在特定临界点将发生改变。例如
交易成本在日交易的$0-15\%$范围间低于在日交易量的$15\%40\%$范围间（或者其他的交易
这里我们将视为投资组合权重，但实际上将交易成本视作交易金额的百分比可能更为直观。通过简单地将乘以投资组合的总金额，投资组合权重和投资组合金额之间的来回转换是容易的。

\begin{figure}[htbp]
\centering
\includegraphics[width=5in]{111.png}
\end{figure}

\subsubsection{二次交易成本}

通常将交易成本参数化为二次函数的形式：
$$TC(t) = c_i|t|+d_i |t|^2$$
系数$c$和$d$是从数据中测定的――比如，在正态条件下用一个二次函数来拟合观测到的特
定股票交易所产生的交易成本模式。
将这个函数包含于投资组合优化问题的目标函数中产生了一个二次程序，其可以用广泛
使用的二次优化软件来求解。

\subsubsection{固定交易成本}

固定交易成本的产生不受交易规模的影响。为了将这类成本加入投资组合优化问题，我
们需要对投资组合中N支股票的每一支引入相对应的二元变量$\delta_1,\ldots,\delta_N$,其中如果股票i
的交易量等于0，$\delta_i$等于0，否则等于1。这个思路与我们在第11.5部分对投资组合中仅能
拥有给定数量的股票的要求来建模是类似的。
假设股票i的固定交易成本是a。那么，交易成本函数为:
$$TC_i = a_i \delta_i$$

目标函数规划为:
$$\max w^T\mu-\lambda w^T\Sigma w-\lambda_{TC}\sum_{i=1}^N pa_i \delta_i$$

为了保证二元变量与交易金额$|w_i-w_{0,i}|$相关，我们需要添加以下的约束:
$$|w_i-w_{0,i}| \leq M\cdot\delta_i,i=1,\ldots,N$$

不同的交易成本模型可以结合使用。例如，如果交易既涉及固定成本也涉及可涞亩次
交易成本，那么我们可以采用如下这类交易成本函数:
$$TC_i = a_i \delta_i+c_i|t|+d_i|t|^2$$

\subsubsection{市场影响成本}
市场影响成本来自交易本身。当证券被买人时其价格通常会被抬高，而被卖出时价格则
会被压低。当交易规模与平均交易量的比率较高时，市场影响可能会是巨大的
学术文献和投资组合软件供应商发表的文章中都已经提到过各种市场影响成本模型。
模型通常会从如下这类幂律函数开始:

$$g(t)=\pm \gamma |t|^a$$

其中，$g(t)$是期望价格变动，系数$\gamma$和指数$a$的数值将通过对数据进行线性和非
线性回归来确定。选择符号以使得$g(t)$与和交易量$t$的符号相同。
例如， Almgre（2005）将影响拆分为永久性的和暂时性的，并
估计了如下交易成本函数:
$$TC_i = a_i |x_i|^{\frac{8}{5}}+b_ix_i^2$$
其中$x_i$是交易的股数。
将投资组合中的全部证券相加，在给定股票$1,\ldots,N$的交易股数$x_1,\ldots,x_N$下，并将总
成本的表达式纳人投资组合优化规划，就可以获得市场影响的总成本。

\subsection{多账户优化}

Chinned、 Scherer和Xu
（2006）描述了这样一个模型，并展现其能实现前文所述的公平的均衡。假设客户k的效用
函数是a，并具有对风险的惩罚，用金额收益表述。假设交易成本模型x给出交易成本的金
额，且x是一个递增的凸函数。其准确形式将取决于交易实施的细节。设t为交易的向量。
它通常的形式为$(t_1^+,\ldots,t_N^+,t_1^-)$也就是说，它将指定每一支股票i＝1，…，N的
累计买入$t_1^+$和累计卖出$t_1^-$但它也可能包含了关于交易是如何进行的信息。
多账户优化问题可以规划为:

$$
{\begin{aligned}
\max ~~&E(u_1(w_1))+\cdots+ E(u_K(w_K))-\tau(t)\\
s.t.~~& w_k \in C_k k=1,\cdots,K
\end{aligned}}$$
其中w是顾客k的股票持有量（或权重）的N维向量，$C_i$是客户k的投资组合结构约束的集
合。目标函数可以解释为净期望效用的最大化，即风险和净交易成本的惩罚后，期望金额收益最大化。

\subsection{涵盖税负}
在美国，当投资组合中的股票升值或贬值时，就会累积资本利得（对应地，责本损失），当
股票被卖出时，投资者对所实现的净资本利得缴纳税负。税金按照股票当前市价及其税基之
差的比例而计算得到，其中税基是股票最初买入时的价格。长期资本利得（当股票持有期超
过一年）的征税比例要低于短期资本利得（当股票持有期在一年之内）。由于同一支股票可能
在不同时点（以不同整批份额）被买入，因此卖出某一批股票而非其他批可能会得出不同的纳
税金额。除了资本利得税负之外，对没有被免税的投资者还需要缴纳其投资组合中股息的税
款。历史上，股息的税率都要高于资本利得，在当前是按照普通收入计税的，即投资者个人的
税率水平。因此，一个特定投资组合的纳税义务取决于交易执行的时间、投资组合的税基、累
积的短期及长期资本利得和投资者的纳税等级。

在美国，超过三分之二的投资组合资产由个人、保险公司和其他按收益纳税的公司所持
有。（也存在例外，如养老基金，其不需每年纳税。）研究已经表明，税负是投资者面对的最大
的费用支出一高于佣金和投资管理费。为了更直观地理解税负在投资者终身收入上的影
响，考虑一个每年资本增值为$6\%$的投资组合。30年后，投资于该投资组合的100美元将转
化为$1000(1+0.06)^{30}=5743．49$美元。现在假设将每年的资本利得变现，资本利得需缴纳
$20\%$的税金，且余下的资本利得再投资。30年后投资于投资组合的100美元将变成$1000
(1+(1-0．20)0.06)^{30}=4081．68$美元，比没有税费的金额要少约$30\%$，即使税率仅为资本
利得的五分之一。

随着投资者越来越注意税负对其收益的显著彩响，投资组合经理面临着越来越大的压力
后情况下变得非常不同。
需要将对税负的考虑纳入其投资组合再平衡决策，并汇报税后表现。因此，近年来，对将税负
纳入投资组合配置决策中的高效计算和严谨量化方法的需求日益增长。然而，从理论和实践
观点上，纳入税负问题的复杂性都是非常高的：
（1）税负义务的存在改变了对甚至是基本面投资组合表现的度量，如市值和风险。因
此，基于税前的评估投资组合表现的成熟方法并不适用于已意识到税负的投资组合的优化。
例如，在传统投资组合管理中，损失与风险相伴，因此应当尽可能被最小化。然而，在税负存
在时，损失的危害可能会减小，因为它们可以用于抵消资本利得并减少投资组合再平衡策略
的税负负担。在税负存在时，基准管理法也变得不那么明显：如果资产的税基不同，则两个具
有完全相同资产的投资组合是不等价的。
（2）税负考虑过于复杂以致无法用一种非自动的方式来实施：与此同时，将其自动纳入
投资组合再平衡算法需要有能力解决非常国难的、大规模的优化问题。
（3）对于具有税负考虑的投资组合管理的最佳方法是，在做出新投资组合权重推荐之前
观测几个阶段（如直到年底）收益预测的优化问题规划。然而，这种对投资组合优化问题的多
期观察在计算上是非常难以解决的一优化问题的维度，即变量和约束数量会随着所考虑时
间段的增加而呈指数增长。

\subsection{稳健的参数估计}

当依赖于历史数据进行估计的时候，我们假设过去为未来提供了一个好的代表。然而，期望回报显示出显著的时间变化（被称为非稳定性）。它们受到市场和经济条件（如利
率、政治环境、消费者信心及不同行业领域和地域的经济周期）变化的影响。因此，外推的历
史收益通常不是未来收益的好的预测。

类似地，协方差矩阵在时间上是不稳定的。此外，上千支股票协方差的样本估计也是众
所周知地不可靠，因为估计它们需要大型数据集，而相关数据如此大的数据集是难以获取的。
在实践中，投资组合经理基于他们对未来趋势的期望和预测模型，通常会主观或客观地
改变不同参数的历史估计。他们也会采用统计方法来寻找对异常值和其他抽样误差不太敏
感的估计量，例如贝叶斯和收缩估计量。

收缩是一种平均不同统计量的形式。收缩估计量通常包含三个组成部分：（1）具有很少
或没有结构的估计量（如样本均值）：（2）具有很多结构的估计量（收缩目标）；（3）反映收缩强
度的系数。金融文献中期望回报最著名的统计量可能是由 Jorion（1986）提出的。 Jorion 模型
中的收缩目标是最小方差投资组合收益的向量数组，收缩强度是从特定公式中确定的
收缩估计量也用于估计收益的协方差矩阵，尽管协方差矩阵估计量的等权重投资组合已经
显示与收缩估计量同样有效。

贝叶斯估计方法基于对特定事件将发生概率的主观解释。概率分布，称为先验分布，用
于代表投资者在任何数据被观测到之前对于概率的了解。在收集更多的信息后（例如，数据
被观测到），一个称作贝叶斯规则（以英国数学家托马斯贝叶斯来命名）的公式被用来计算
新的概率分布，称为后验分布。

\subsection{投资组合再抽样}

假设有N支备选股票的投资组合，其股票期望回报的初始估计是$\mu$:
（1）从均值为$\mu$、协方差矩阵为$\Sigma$的多元正态分布中模拟N支回报的S组样本
（2）利用（1）中得到的S组样本来计算期望回报$u_1,\ldots,u_s $和协方差矩阵$\Sigma_1,\ldots,\Sigma_s $
向量的S组新估计。
（3）求解S组投资组合优化间题，对每一对估算的期望回报和协方差$(\mu_S,\Sigma_S)$都有一组
解，并保留向量数组w中N支股票的权重，s＝$1,\ldots,S $。（优化问题本身可以是任何标准
的均值一方差规划：在风险约束下使期望回报最大化，在期望回报约束下使风险最小化，或是
效用函数最大化。
（4）为了发现最终投资组合权重，我们对在S个权重中每一支股票的权重进行平均，该
S个权重来自该股票在S组优化问题中的每一组。也就是说：
$$w=\frac{1}{S}\sum_{s=1}^{S}w^{s}$$

例如，投资组合中股票i的最终权重等于：

$$w=\frac{1}{S}\sum_{s=1}^{S}w_i^{s}$$

再抽样有其缺点：

因为再抽样的投资组合是通过模拟过程计算的，其中投资组合优化问题需要在每一步
求解，因此这个方法在计算上是繁琐的，特别是对大的投资组合。再抽样的步骤数和对误差
在投资组合构成上影响的估计的精确度之间存在权衡关系。
由于在计算中是对最终投资组合权重取均值，因此很有可能所有股票最终都具有非零
权重。如果最终投资组合被采用，这对将发生的交易成本造成影响。一种可能性是采用约|
来限制换手和非零权重股票的数量。然而，如我们在第11.1节中所见，采用这种约束将使优
化问题变得更加复杂，且可能使得再抽样过程变慢。
因为取均值过程是在优化问题解决后发生的，最终的权重可能实际上并不满足优化规
划中的一些约束。通常来说，仅有凸（如线性）约束一定会被取均值的最终权重来满足。例
如，不一定满足换手约束。这是实践应用中再抽样方法的一个严重局限。

\subsection{稳健的投资组合优化}

让我们举一个关于稳健优化框架是如何可以被应用于投资组合优化情的具体案例
考虑第8.4.2部分中经典的均值一方差投资组合配置问题的效用函数规划：

$${\begin{aligned}
\max_w ~~~&w^T\mu - \lambda w^{T}\Sigma w\\
s.t. ~~~& w^T\mathbf{1}  =1
\end{aligned}}$$

假设我们有期望回报和协方差矩阵的向量估计$\hat{\mu},\hat{\Sigma}$。我们将考虑一组“接近”
$\hat{\mu}$的向量$\mu$，而不是估计μ本身。我们定义不确定性集合:

$$U_\delta(\hat{\mu}) = \{\mu||u_i-\hat{\mu_i}| \leq \delta_i ,i=1,\ldots,N\}$$
换言之，集合$U_\delta(\hat{\mu})$包括所有向量$\mu = (\mu_1,\dots,\mu_N)$其中每个元素$\mu$都在区间$[u_i-\delta_i,u_i+\delta_i]$之内。

我们可以引入一个新的决策变量$v$，并将目标函数的表达式设为一个约束：
$${\begin{aligned}
\max_w ~~~&v\\
s.t. ~~~& w^T\mathbf{1}  =1\\
&w^T\mu - \lambda w^{T}\Sigma w \geq v
\end{aligned}}$$

这是优化中的一个标准技巧：决策变量的值将被最大化，但它被上式中的表达式$w^T\mu - \lambda w^{T}\Sigma w$约束，使得优化法将试图令$w^T\mu - \lambda w^{T}\Sigma w$尽可能大（即令其最大化）。这个问题的
最优解没有改变，但现在我们可以计算出约束的稳健对等式：
$$w^T\mu - \lambda w^{T}\Sigma w \geq v$$ 

采用如我们在第7．3节中对一般类型的约束:
$$a^Tx\leq b$$

同样的方法。也就是，我们先求解类如下式的优化问题：
$$\max_{\mu\in U_\delta(\hat{\mu}) }\{w^T\mu - \lambda w^{T}\Sigma w\} \leq -v$$

这个问题等价于:
$$\max_{\mu\in U_\delta(\hat{\mu}) }\{w^T\mu\} \leq -\lambda w^{T}\Sigma w\ -v$$

井且，由于约束右边的表达式中没有$\mu$，我们可以将整个表达式当作一个（关于的$\mu$）常数
换句话说，我们有约束$a^Tx\leq b$其中 $a=\mu,x=w,b=-\lambda w^{T}\Sigma w\ -v$

在期望回报的不确定性集合箱下，均值一方差优化问题的稳健对等式为
$${\begin{aligned}
\max_w ~~~&w^T\mu - \delta^T |w| - \lambda w^{T}\Sigma w \\
s.t. ~~~& w^T\mathbf{1}  =1
\end{aligned}}$$

其中 $|w|$标示了权重向量w的绝对值。为了直观起见，注意到如果投资组合中股票i的权重
为负数，那么股票期望回报的最坏结果就是$\mu+\delta_i$。（我们可能的最大损失量）。如果投资组
合中股票的权重是正的，那么股票i期望回报的最坏结果是$\mu-\delta_i$，（我们可能的最小收益
量）目标函数中的数学表达式与直觉相符：它使得投资组合期
望回报的最坏情况最小化。在这个均值一方差规划的稳健版本中，那些平均回报估计不太精
确的股票（即具有一个更大的估计误差$\delta_i$）因此在目标函数中被惩罚，且通常将在最优投资组
合配置中有一个更小的权重。

这个优化问题和非稳健的均值一方差规划具有相同的计算复杂度一也就是说，它可以
表述为一个二次优化问题。这可以通过采用第11.1节中所用的技巧将权重的绝对值去掉而
实现。即，我们引进额外变量的N维向量$\phi$来代替绝对值$|w|$，并将优化问题写成等同的版本：
$${\begin{aligned}
\max_w ~~~&w^T\mu - \delta^T \phi - \lambda w^{T}\Sigma w \\
s.t. ~~~& w^T\mathbf{1}  =1\\
&\phi\geq w_i,\phi \geq -w_i,i=1,\ldots,N
\end{aligned}}$$

对于期望回报估计的椭圆形不确定性集，均值一方差投资组合优化问题的稳健对等式被
证明是下列优化问题规划：

$${\begin{aligned}
\max_w ~~~&w^T\mu - \delta \sqrt{w^{T}\Sigma_u w } - \lambda w^{T}\Sigma w \\
s.t. ~~~& w^T\mathbf{1}  =1
\end{aligned}}$$
其中$\Sigma_u$是期望回报向量的估计误差的协方差矩阵。这是一个二阶锥同题，它需要专业软件来求解，但是求解它的方法是非常有效的。

在实践中，几种估计的近似方法已经被发现有效。例如，已经观测到更简单的估计方
式，如采用包含了估计方差的对角矩阵（而不是完全的误差协方差矩阵），它们常常在稳健投
资组合优化中带来最多益处。此外，估计期望回报的标准方式，如贝叶斯统计和基于回归的
方法，可以在其自身估计生成过程中产生对估计误差协方差矩阵的估计

然而，稳健优化不是万能的。通过使用稳健的投资组合优化规划，投资者可能会为了防
范估计不准确的风险，而含弃他们最优的投资组合配置，在该配置中实际与预期是一致的。
因此，当估计误差没有什么影响或当典型场景发生时，采用该技术的投资者不应该期望优于
经典的投资组合优化。然而，在那些场景中，当他们的估计偏离实际实现值达到其在建模过
程中预先设定的数量，他们应该期望稳操胜券。

\end{CJK*}
\end{document}
